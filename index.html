<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="re.png">
    <title>Clever Score Sheets</title>
    <style>
        @font-face {
            font-family: "numbers";
            src: url(data:font/woff2;base64,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)format("woff2");
        }

        * {
            touch-action: manipulation;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            display: flex;
            height: 100dvh;
            flex-direction: column;
            user-select: none;
            font-family: sans-serif;
            flex-direction: column;
        }

        #outer-container {
            position: relative;
            overflow: hidden;
            flex-grow: 1;
        }

        #image-container {
            width: 700px;
            height: 1000px;
            overflow: hidden;
            position: relative;
            left: 50%;
            top: 50%;
            transform-origin: center;
            transform: translate(-50%, -100%);
        }

        img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
        }

        .mark {
            position: absolute;
            border-radius: 50%;
            border: 5px solid transparent;
            font-family: 'numbers';
            font-size: 30px;
            line-height: 35px;
            width: 35px;
            height: 35px;
            text-align: center;
            /* background-color: rgba(0,0,0,.3); */
        }

        .circle.marked {
            border: 5px solid black;
        }

        .cross.marked {
            background-image: url('Ex.png');
            background-size: 100%;
            background-repeat: no-repeat;
        }

        .redcross.marked {
            background-image: url('Ex.png');
            background-size: 100%;
            background-repeat: no-repeat;
            filter: invert(14%) sepia(87%) saturate(6866%) hue-rotate(359deg) brightness(100%) contrast(114%);
        }

        .small {
            transform: scale(.75);
        }

        .hide {
            opacity: 0;
        }

        #resizable-image {
            position: absolute;
        }

        #dice-modal {
            position: absolute;
            display: none;
            font-family: 'numbers';
            color: #333;
            font-size: 38px;
            line-height: 38px;
            background-color: #777;
            border: 5px solid white;
            border-radius: 10px;
            transform: translate(-50%, -100%);
            z-index: 2;
        }

        #dice-modal>div {
            display: block;
            width: 35px;
            height: 35px;
            border: 3px solid black;
            border-radius: 10px;
            text-align: center;
            background-color: white;
            margin: 5px;
            cursor: pointer;
        }

        #score-modal {
            position: absolute;
            width: 415px;
            gap: 10px 15px;
            flex-wrap: wrap;
            font-family: 'numbers';
            color: #333;
            font-size: 38px;
            line-height: 38px;
            background-color: #fff;
            border: 7px solid #ddd;
            border-radius: 13px;
            z-index: 2;
            padding: 10px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        #score-modal>div {
            box-sizing: border-box;
            width: 200px;
            height: 80px;
            border-radius: 13px;
            font-family: numbers;
            text-align: center;
            font-size: 55px;
            line-height: 80px;
        }

        #score-modal>div.score-points {
            border-width: 7px;
            border-style: solid;
            background-color: transparent;
            line-height: 66px;
        }

        #board-modal {
            position: absolute;
            width: 600px;
            gap: 10px 15px;
            flex-wrap: wrap;
            flex-direction: column;
            font-family: 'numbers';
            color: #333;
            font-size: 38px;
            line-height: 38px;
            background-color: #fff;
            border: 7px solid #ddd;
            border-radius: 13px;
            z-index: 3;
            padding: 10px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
        }

        #board-modal-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #board-modal>div:not(#board-modal-list),
        #board-modal-list>div {
            width: 100%;
            height: 45px;
            border-radius: 13px;
            font-family: sans-serif;
            text-align: center;
            font-size: 40px;
            line-height: 45px;
            cursor: pointer;
            border: 3px solid black;
            background-color: #ccc;
        }

        #history-modal {
            position: absolute;
            width: 600px;
            height: 900px;
            gap: 10px 15px;
            flex-direction: column;
            color: #333;
            font-size: 24px;
            line-height: 38px;
            background-color: #fff;
            border: 7px solid #ddd;
            border-radius: 13px;
            z-index: 3;
            padding: 10px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
        }

        #history-modal-list {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        #history-modal-list>div {
            display: flex;
            flex-direction: row;
            gap: 15px;
            cursor: pointer;
        }

        #history-modal-list>div:nth-child(odd) {
            background-color: #ccc;
        }

        #history-modal-list>div>div:nth-child(1) {
            min-width: 120px;
        }

        #history-modal-list>div>div:nth-child(2) {
            flex-grow: 1;
        }

        #history-modal-list>div>div:nth-child(3) {
            font-size: 30px;
            font-family: 'numbers';
        }

        #history-modal>div:not(#history-modal-list) {
            width: 100%;
            height: 45px;
            border-radius: 13px;
            font-family: sans-serif;
            text-align: center;
            font-size: 40px;
            line-height: 45px;
            cursor: pointer;
            border: 3px solid black;
            background-color: #ccc;
        }

        select {
            appearance: none;
            text-align: center;
            background-color: transparent;
            border: none;
            padding: 0 20px;
            margin: 0;
            font-family: inherit;
            font-size: inherit;
            cursor: inherit;
            line-height: inherit;
        }

        option {
            font-size: 25px;
        }

        #menu-bar {
            padding: 10px 10px 0px 10px;
            color: #ee9;
            display: flex;
            gap: 30px;
            justify-content: center;
            height: 30px;
            font-size: 25px;
            line-height: 30px;
            max-width: 100vw;
        }

        #menu-bar>input {
            min-width: 50px;
            max-width: 300px;
            flex-grow: 1;
            flex-shrink: 1;
        }

        #menu-bar>* {
            display: none;
            cursor: pointer;
        }

        #menu-bar>div.disabled {
            filter: brightness(.4);
            cursor: default
        }

        #menu-bar.menu-mode-0>.menu-mode-0 {
            display: block
        }

        #menu-bar.menu-mode-1>.menu-mode-1 {
            display: block
        }

        #menu-bar.menu-mode-2>.menu-mode-2 {
            display: block
        }

        #menu-score-value {
            width: 30px;
            font-family: 'numbers';
            position: absolute;
            text-align: center;
            font-size: 24px;
            line-height: 30px;
        }

        .board1 div.color1 {
            background-color: #ffd503;
            border-color: #ffd503
        }

        .board1 div.color2 {
            background-color: #0b7cc1;
            border-color: #0b7cc1
        }

        .board1 div.color3 {
            background-color: #0baf4d;
            border-color: #0baf4d
        }

        .board1 div.color4 {
            background-color: #f58220;
            border-color: #f58220
        }

        .board1 div.color5 {
            background-color: #522f91;
            border-color: #522f91
        }

        .board2 div.color1 {
            background-color: #939598;
            border-color: #939598
        }

        .board2 div.color2 {
            background-color: #ffc20e;
            border-color: #ffc20e
        }

        .board2 div.color3 {
            background-color: #0c4da2;
            border-color: #0c4da2
        }

        .board2 div.color4 {
            background-color: #8dc63f;
            border-color: #8dc63f
        }

        .board2 div.color5 {
            background-color: #f287b7;
            border-color: #f287b7
        }

        .board3 div.color1 {
            background-color: #ffbd00;
            border-color: #ffbd00
        }

        .board3 div.color2 {
            background-color: #00a4a2;
            border-color: #00a4a2
        }

        .board3 div.color3 {
            background-color: #002498;
            border-color: #002498
        }

        .board3 div.color4 {
            background-color: #ba7b47;
            border-color: #ba7b47
        }

        .board3 div.color5 {
            background-color: #ff56ad;
            border-color: #ff56ad
        }

        .board4 div.color1 {
            background-color: #ffbd00;
            border-color: #ffbd00
        }

        .board4 div.color2 {
            background-color: #00aae2;
            border-color: #00aae2
        }

        .board4 div.color3 {
            background-color: #b0b2b4;
            border-color: #b0b2b4
        }

        .board4 div.color4 {
            background-color: #72ca36;
            border-color: #72ca36
        }

        .board4 div.color5 {
            background-color: #ff84c0;
            border-color: #ff84c0
        }
    </style>
</head>

<body>
    <div id="menu-bar" class="menu-mode-0">
        <div class="menu-mode-2" id="menu-history-prev"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path d="M560-240 320-480l240-240 56 56-184 184 184 184-56 56Z" />
            </svg></div>
        <div class="menu-mode-0 menu-mode-2" id="menu-score">
            <div id="menu-score-value">123</div><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30">
                <path style="fill:#fff"
                    d="M620-360q-17 0-28.5-11.5T580-400v-160q0-17 11.5-28.5T620-600h100q17 0 28.5 11.5T760-560v160q0 17-11.5 28.5T720-360H620Zm20-60h60v-120h-60v120Zm-440 60v-100q0-17 11.5-28.5T240-500h80v-40H200v-60h140q17 0 28.5 11.5T380-560v60q0 17-11.5 28.5T340-460h-80v40h120v60H200Zm250-160v-60h60v60h-60Zm0 140v-60h60v60h-60ZM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h120v-80h80v80h240v-80h80v80h120q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm0-80h290v-60h60v60h290v-480H510v60h-60v-60H160v480Zm0 0v-480 480Z" />
            </svg>
        </div>
        <div class="menu-mode-0" id="menu-undo"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30">
                <path style="fill:#fff"
                    d="M280-200v-80h284q63 0 109.5-40T720-420q0-60-46.5-100T564-560H312l104 104-56 56-200-200 200-200 56 56-104 104h252q97 0 166.5 63T800-420q0 94-69.5 157T564-200H280Z" />
            </svg></div>
        <input class="menu-mode-2" type="range" id="log-slider" value="100" min="0" max="100" step="1"
            oninput="scaleLog()">
        <div class="menu-mode-0" id="menu-redo"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path
                    d="M396-200q-97 0-166.5-63T160-420q0-94 69.5-157T396-640h252L544-744l56-56 200 200-200 200-56-56 104-104H396q-63 0-109.5 40T240-420q0 60 46.5 100T396-280h284v80H396Z" />
            </svg></div>
        <div class="menu-mode-0" id="menu-scale"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path
                    d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400ZM280-540v-80h200v80H280Z" />
            </svg></div>
        <div class="menu-mode-0" id="menu-fs">
            <svg xmlns="http://www.w3.org/2000/svg" height="30" viewBox="0 -960 960 960" width="30" id="icon-fs"
                style="fill:#fff">
                <path
                    d="M120-120v-200h80v120h120v80H120Zm520 0v-80h120v-120h80v200H640ZM120-640v-200h200v80H200v120h-80Zm640 0v-120H640v-80h200v200h-80Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" height="30" viewBox="0 -960 960 960" width="30" id="icon-fs-exit"
                style="fill:#fff;display:none">
                <path
                    d="M240-120v-120H120v-80h200v200h-80Zm400 0v-200h200v80H720v120h-80ZM120-640v-80h120v-120h80v200H120Zm520 0v-200h80v120h120v80H640Z" />
            </svg>
        </div>
        <div class="menu-mode-0 menu-mode-2" id="menu-reset"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path
                    d="M200-120q-33 0-56.5-23.5T120-200v-160h80v160h560v-560H200v160h-80v-160q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm220-160-56-58 102-102H120v-80h346L364-622l56-58 200 200-200 200Z" />
            </svg></div>
        <div class="menu-mode-2" id="menu-delete"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path
                    d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z" />
            </svg></div>
        <div class="menu-mode-1" id="menu-scale-close"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z" />
            </svg></div>
        <input class="menu-mode-1" type="range" id="scale-slider" value="100" min="30" max="100" step="1"
            oninput="scaleContainer()">
        <div class="menu-mode-2" id="menu-history-next"><svg xmlns="http://www.w3.org/2000/svg" height="30"
                viewBox="0 -960 960 960" width="30" style="fill:#fff">
                <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" />
            </svg></div>
    </div>
    <div id="outer-container">
        <div id="image-container">
            <div id="board-modal" style="display:none;">
                <div id="board-modal-list"></div>
                <div id="board-history">History</div>
                <div id="board-back">Back</div>
            </div>
            <div id="history-modal" style="display:none;">
                <div><select id="history-board-select"></select></div>
                <div id="history-by-score">Sort by score</div>
                <div id="history-by-date" style="display: none;">Sort by date</div>
                <div id="history-show-incomplete">Show incomplete</div>
                <div id="history-hide-incomplete" style="display: none;">Hide incomplete</div>
                <div id="history-modal-list"></div>
                <div id="history-exit">Back</div>
            </div>
            <img id="resizable-image" src="back1.png">
            <div id="score-modal" style="display:none;">
                <div class="color1">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score1" class="color1 score-points">456</div>
                <div class="color2">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score2" class="color2 score-points">456</div>
                <div class="color3">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score3" class="color3 score-points">456</div>
                <div class="color4">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score4" class="color4 score-points">456</div>
                <div class="color5">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score5" class="color5 score-points">456</div>
                <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                    <g transform="translate(-1.8520818,-12.435417)">
                        <path
                            d="m 0,0 v 6.825 c 0,0.938 -0.768,1.706 -1.706,1.706 h -22.181 c -0.938,0 -1.706,-0.768 -1.706,-1.706 V 0 c 0,-0.938 0.768,-1.706 1.706,-1.706 H -1.706 C -0.768,-1.706 0,-0.938 0,0 m -0.853,0 c 0,-0.47 -0.382,-0.853 -0.853,-0.853 h -22.181 c -0.47,0 -0.853,0.383 -0.853,0.853 v 6.825 c 0,0.47 0.383,0.853 0.853,0.853 h 22.181 c 0.471,0 0.853,-0.383 0.853,-0.853 V 0"
                            style="fill:#ed1c24;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,10.880723,15.444964)" />
                        <path
                            d="M 0,0 C -0.013,0.017 -0.015,0.032 -0.009,0.053 0.078,0.333 0.15,0.617 0.219,0.902 0.28,1.154 0.339,1.407 0.387,1.662 0.411,1.786 0.436,1.91 0.459,2.035 0.487,2.188 0.512,2.341 0.536,2.496 0.557,2.628 0.575,2.761 0.587,2.895 0.596,2.991 0.607,3.087 0.614,3.183 0.622,3.318 0.657,3.695 0.528,3.78 0.398,3.864 -0.389,3.203 -0.594,3 -0.881,2.715 -1.153,2.417 -1.417,2.113 -1.57,1.937 -1.72,1.758 -1.869,1.579 -1.882,1.563 -1.893,1.56 -1.912,1.567 -2.042,1.616 -2.176,1.654 -2.313,1.677 -2.396,1.691 -2.477,1.706 -2.562,1.709 -2.62,1.711 -2.678,1.716 -2.736,1.715 -2.998,1.713 -3.253,1.662 -3.5,1.576 -3.543,1.561 -3.585,1.545 -3.627,1.527 -3.644,1.52 -3.653,1.523 -3.664,1.537 -3.852,1.769 -4.044,1.996 -4.241,2.22 -4.525,2.542 -5.666,3.849 -5.888,3.672 -6.11,3.494 -5.564,0.073 -5.508,-0.094 -5.513,-0.112 -5.526,-0.125 -5.536,-0.14 -5.912,-0.699 -6.19,-1.304 -6.389,-1.947 c -0.004,-0.01 -0.085,-0.128 -0.014,-0.161 0.071,-0.033 0.119,0.063 0.179,0.094 0.082,0.041 0.163,0.081 0.249,0.113 -0.005,-0.014 -0.18,-0.322 -0.084,-0.348 0.096,-0.026 0.384,0.135 0.568,0.186 0.247,0.07 0.497,0.109 0.753,0.065 0.244,-0.041 0.446,-0.154 0.6,-0.35 0.141,-0.179 0.218,-0.386 0.267,-0.605 0.033,-0.143 0.054,-0.29 0.107,-0.429 0.052,-0.138 0.125,-0.26 0.253,-0.341 0.061,-0.039 0.128,-0.058 0.196,-0.076 0.019,-0.039 0.048,-0.071 0.082,-0.098 0.124,-0.101 0.268,-0.148 0.425,-0.163 0.06,-0.006 0.12,-0.006 0.181,0 0.11,0.009 0.215,0.037 0.312,0.088 0.079,0.041 0.152,0.091 0.195,0.173 0.005,0.002 0.01,0.005 0.015,0.006 0.176,0.035 0.297,0.139 0.38,0.295 0.077,0.143 0.11,0.298 0.141,0.455 0.036,0.185 0.086,0.365 0.177,0.532 0.101,0.185 0.239,0.332 0.43,0.424 0.226,0.112 0.466,0.124 0.711,0.093 0.194,-0.025 0.381,-0.08 0.564,-0.15 C 0.4,-2.184 0.549,-2.307 0.621,-2.269 0.694,-2.23 0.604,-2.111 0.583,-2.033 0.57,-1.988 0.548,-1.947 0.541,-1.901 0.685,-1.961 0.935,-2.16 0.999,-2.128 1.063,-2.097 0.905,-1.801 0.848,-1.641 0.64,-1.056 0.362,-0.507 0,0"
                            style="fill:#ed1c24;fill-opacity:1;fill-rule:nonzero;stroke:#dfdfdf;stroke-width:0.341;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:3;stroke-dasharray:none;stroke-opacity:1"
                            transform="matrix(0.35277776,0,0,-0.35277776,7.1618804,14.150268)" />
                        <path
                            d="m 0,0 c 0.019,-0.189 -0.082,-0.321 -0.213,-0.436 -0.127,-0.111 -0.277,-0.165 -0.445,-0.151 -0.132,0.011 -0.245,0.073 -0.345,0.159 -0.105,0.092 -0.177,0.203 -0.209,0.34 -0.007,0.03 0,0.059 0.006,0.089 0.057,0.16 0.187,0.238 0.337,0.282 0.215,0.063 0.429,0.055 0.635,-0.039 C -0.125,0.194 -0.039,0.119 0,0"
                            style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,6.4231293,15.13152)" />
                        <path
                            d="M 0,0 C -0.282,0.003 -0.508,0.233 -0.506,0.516 -0.504,0.794 -0.273,1.021 0.008,1.02 0.292,1.018 0.518,0.789 0.514,0.505 0.51,0.201 0.262,-0.006 0,0"
                            style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,6.6620296,14.638125)" />
                        <path
                            d="M 0,0 C -0.257,0.001 -0.504,0.233 -0.492,0.528 -0.48,0.807 -0.248,1.027 0.033,1.019 0.302,1.01 0.531,0.8 0.528,0.493 0.526,0.215 0.285,-0.007 0,0"
                            style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,5.7486879,14.637913)" />
                    </g>
                </svg>
                <div id="score6" style="border: 7px solid #ed1c24; line-height: 66px;">123</div>
                <div style="font-family: sans-serif; font-weight:bold;">Σ</div>
                <div id="score" style="background-color: #d0d0d0;">1230</div>
            </div>
            <div id="dice-modal"></div>
        </div>
    </div>


    <script>
        function scaleContainer() {
            const sliderValue = document.getElementById('scale-slider').value;
            const container = document.getElementById('image-container');
            const baseScale = Math.min(container.parentElement.clientHeight / 1000, container.parentElement.clientWidth / getWidth());
            container.style.transform = `translate(-50%, -50%) scale(${sliderValue / 100 * baseScale})`;
            localStorage.setItem('scale', sliderValue.toString());
        }
        function scaleLog() {
            const sliderValue = document.getElementById('log-slider').value;
            logSetPos(sliderValue);

        }
        document.getElementById('menu-score-value').onclick =
            document.getElementById('menu-score').onclick = document.getElementById('score-modal').onclick = () => {
                const e = document.getElementById('score-modal');
                e.style.display = e.style.display == 'none' ? 'flex' : 'none'
            };
        document.getElementById('menu-undo').onclick = () => logUndo();
        document.getElementById('menu-redo').onclick = () => logRedo();
        document.getElementById('menu-history-prev').onclick = () => historyBrowser.prev();
        document.getElementById('menu-history-next').onclick = () => historyBrowser.next();
        document.getElementById('menu-reset').onclick = () => {
            document.getElementById(historyMode ? 'history-modal' : 'board-modal').style.display = 'flex';
            document.getElementById('score-modal').style.display = 'none';
        }
        document.getElementById('history-exit').onclick = () => {
            document.getElementById('history-modal').style.display = 'none';
            document.getElementById('board-modal').style.display = 'flex';
            historyMode = false;
            updateBoard();
        }
        document.getElementById('history-by-date').onclick = () => {
            document.getElementById('history-by-date').style.display = 'none';
            document.getElementById('history-by-score').style.display = 'block';
            historyOrder = 'date';
            historyBrowser.updateEntries();
            updateBoard()
        }
        document.getElementById('history-by-score').onclick = () => {
            document.getElementById('history-by-score').style.display = 'none';
            document.getElementById('history-by-date').style.display = 'block';
            historyOrder = 'score';
            historyBrowser.updateEntries();
            updateBoard()
        }
        document.getElementById('history-show-incomplete').onclick = () => {
            document.getElementById('history-show-incomplete').style.display = 'none';
            document.getElementById('history-hide-incomplete').style.display = 'block';
            historyFilterIncomplete = false;
            historyBrowser.updateEntries();
            updateBoard()
        }
        document.getElementById('history-hide-incomplete').onclick = () => {
            document.getElementById('history-hide-incomplete').style.display = 'none';
            document.getElementById('history-show-incomplete').style.display = 'block';
            historyFilterIncomplete = true;
            historyBrowser.updateEntries();
            updateBoard()
        }
        document.getElementById('history-board-select').onchange = () => {
            historyBrowser.updateEntries();
            updateBoard();
        }
        document.getElementById('menu-delete').onclick = () => {
            historyBrowser.remove();
            if (!historyBrowser.entries().length) {
                document.getElementById('history-modal').style.display = 'flex';
                document.getElementById('score-modal').style.display = 'none';
                updateBoard();
            }
        }
        document.getElementById('menu-fs').onclick = () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
        document.onfullscreenchange = () => {
            if (document.fullscreenElement) {
                document.getElementById('icon-fs-exit').style.display = 'block';
                document.getElementById('icon-fs').style.display = 'none';
            } else {
                document.getElementById('icon-fs').style.display = 'block';
                document.getElementById('icon-fs-exit').style.display = 'none';
            }
        }
        document.getElementById('menu-scale').onclick = () => {
            const e = document.getElementById('menu-bar');
            e.className = 'menu-mode-1';
        }
        document.getElementById('menu-scale-close').onclick = () => {
            const e = document.getElementById('menu-bar');
            e.className = 'menu-mode-0'
        }

        const state = {
            marked: {},
            log: [],
            logPos: 0,
        }
        function logFromString(compactLog) {
            state.log = [];
            for (let i = 0; i < compactLog.length;) {
                const len = board.markAsValue(compactLog[i]) ? 3 : 2;
                state.log.push(compactLog.substring(i, i + len));
                i += len;
            }
            state.logPos = state.log.length;
            replayLog();
        }
        function logToString() {
            return state.log.slice(0, state.logPos).join('');
        }
        function logAppend(v) {
            state.log.splice(state.logPos++, Infinity, v);
            save();
            historySaved = false;
        }
        function logSetPos(pos) {
            if (pos < 0 || pos > state.log.length) return;
            state.logPos = pos;
            replayLog();
        }
        function logUndo() {
            if (!state.logPos) return;
            state.logPos--;
            replayLog();
            save();
        }
        function logRedo() {
            if (state.logPos >= state.log.length) return;
            state.logPos++;
            replayLog();
            save();
        }
        function logClear() {
            state.log = [];
            state.logPos = 0;
            replayLog();
            save();
        }
        function logCanUndo() { return state.logPos > 0; }
        function logCanRedo() { return state.logPos < state.log.length; }
        function logEmpty() { return !state.logPos; }
        function logIncomplete() {
            return !state.log.includes('r4') || state.log.filter(l => !['R', 'X', 'A', 'B', 'C'].includes(l[0].toUpperCase())).length < 20;
        }
        function logGetPos() { return state.logPos; }
        function logMaxPos() { return state.log.length; }
        function replayLog() {
            state.marked = {};
            state.log.slice(0, state.logPos).forEach(v => {
                state.marked[v.substring(0, 2)] = v.length > 2 ? board.writeValue(v.substring(0, 2), parseInt(v[2], 36)) : true;
                board.autoMark();
            });
            updateBoard();
        }
        function save() {
            localStorage.setItem('state', board.id + logToString());
        }
        function load() {
            const s = localStorage.getItem('state');
            if (!s) return;
            const boardId = s.substring(0, 2);
            const b = boards.find(b => b.id === boardId);
            if (!b) return;
            buildBoard(b);
            logFromString(s.substring(2));
        }
        function parseId(id) { return [id[0], parseInt(id[1], 36)]; }
        function makeId(t, i) {
            const isLower = t !== t.toUpperCase();
            const id = t + i.toString(36);
            return isLower ? id.toLowerCase() : id.toUpperCase();
        }
        function prevId(id) {
            const [t, i] = parseId(id);
            return i < 2 ? undefined : makeId(t, i - 1);
        }
        function prevMarked(id) {
            const prev = prevId(id);
            return !prev || prev in state.marked;
        }
        function tryMark(id, ...deps) {
            if (deps.every(d => d in state.marked)) state.marked[id] = true;
        }
        function tryMarkMin(id, dep, val, alt) {
            if (state.marked[dep] >= val) state.marked[id] = true;
            else if (alt !== undefined && (dep in state.marked)) state.marked[alt] = true;
        }
        function tryMarkAll(...ids) {
            if (ids.some(d => d in state.marked)) ids.forEach(id => state.marked[id] = true);
        }
        function bonusMark(t1, t2) {
            const count = countType(t1);
            for (let i = 1; i <= count; i++) state.marked[t2 + i] = true;
        }
        function countType(t) {
            return Object.keys(state.marked).reduce((a, id) => a + (id[0] === t ? 1 : 0), 0);
        }
        function sumType(t, fn = x => x) {
            return Object.keys(state.marked).reduce((a, id) => a + (id[0] === t ? fn(state.marked[id], parseId(id)[1]) : 0), 0);
        }
        function addFoxScore(...scores) {
            return [...scores, countType('F') * Math.min(...scores)];
        }
        function makeMark(id, left, top, ...classes) {
            const container = document.querySelector('#image-container');
            const newDiv = document.createElement('div');
            newDiv.id = id;
            newDiv.classList.add('mark');
            classes.forEach(c => newDiv.classList.add(c));
            newDiv.style.top = top + 'px';
            newDiv.style.left = left + 'px';
            container.appendChild(newDiv);
        }
        function makeXMark(id, left, top, ...classes) {
            makeMark('x' + id, left, top, 'circle', ...classes);
            makeMark('X' + id, left, top, 'cross', ...classes);
        }
        function gen(t, w, h = 1, isValid = () => true) {
            const res = [];
            let idx = 1;
            if (t.length > 1) [t, idx] = parseId(t);
            const isLower = t !== t.toUpperCase();
            for (let j = 0; j < h; j++) for (let i = 0; i < w; i++) if (isValid(i, j)) {
                res.push([makeId(t, idx++), i, j]);
            }
            return res;
        }
        let board;
        function buildBoard(b) {
            document.getElementById('dice-modal').style.display = 'none';
            board = b;
            const container = document.querySelector('#image-container');
            const image = document.querySelector('#resizable-image');
            const markElements = container.querySelectorAll('.mark');
            image.src = board.image;
            container.style.width = getWidth() + 'px';
            container.className = board.colorScheme;
            markElements.forEach(el => el.remove());
            board.buildBoard();
            scaleContainer();
        }
        function getWidth() {
            return board.width || 700;
        }
        const board1A = {
            id: '1A',
            name: 'That\'s Pretty Clever!',
            image: '1A.jpg',
            colorScheme: 'board1',
            buildBoard: (container) => {
                // Round track
                gen('r', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'cross'));
                makeMark('X0', 141.5 + 3 * 96.6, 70, 'cross');
                // Action tracks
                gen('a', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'cross'));
                // Yellow
                gen('1', 4, 4, (x, y) => 3 - x !== y).forEach(([id, x, y]) => makeMark(id, 39 + x * 60, 359 + y * 57, 'cross'));
                makeXMark('1', 285, 359 + 0 * 57);
                makeXMark('2', 285, 359 + 1 * 57);
                makeXMark('3', 285, 359 + 2 * 57);
                makeMark('F1', 285, 359 + 3 * 57, 'circle');
                gen('S', 4).forEach(([id, x]) => makeMark(id, 39 + x * 60, 600, 'circle'));
                makeMark('P2', 285, 595, 'circle');
                // Blue
                gen('2', 4, 3, (x, y) => x + y).forEach(([id, x, y]) => makeMark(id, 378 + x * 60.7, 423.5 + y * 57, 'cross'));
                makeXMark('4', 626, 423.5 + 0 * 57);
                makeXMark('5', 626, 423.5 + 1 * 57);
                makeMark('F2', 626, 423.5 + 2 * 57, 'circle');
                makeMark('O3', 378 + 0 * 60.7, 603, 'circle');
                makeXMark('6', 378 + 1 * 60.7, 603);
                makeXMark('7', 378 + 2 * 60.7, 603);
                makeMark('P3', 378 + 3 * 60.7, 603, 'circle');
                // Green
                gen('3', 11).forEach(([id, x]) => makeMark(id, 91 + x * 52.9, 702.5, 'cross'));
                makeMark('X8', 91 + 5 * 52.9, 732, 'cross');
                makeMark('X9', 91 + 8 * 52.9, 732, 'cross');
                // Orange
                gen('4', 11).forEach(([id, x]) => makeMark(id, 91 + x * 52.9, 803));
                makeMark('XA', 91 + 4 * 52.9, 831, 'cross');
                makeMark('XB', 91 + 9 * 52.9, 831, 'cross');
                // Purple
                gen('5', 11).forEach(([id, x]) => makeMark(id, 91 + x * 52.9, 902.5));
                makeMark('XC', 91 + 3 * 52.9, 931.5, 'cross');
                makeMark('XD', 91 + 5 * 52.9, 931.5, 'cross');
                makeMark('XE', 91 + 8 * 52.9, 931.5, 'cross');
                makeMark('XF', 91 + 9 * 52.9, 931.5, 'cross');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = id;
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '3' || t === '4' || t === '5') return prevMarked(id);
                if (t === '1' || t === '2') return true;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '4' || id[0] === '5',
            allowValue: (id) => id[0] === '4' || id === '51' ? allow1d() : allow1d(val => state.marked[prevId(id)] % 6 < val),
            writeValue: (id, val) => (({ '44': 2, '47': 2, '49': 2, '4B': 3 })[id] || 1) * val,
            score: () => {
                const yellowScore = sumType('S', (_, i) => [10, 14, 16, 20][i - 1]);
                const blueCount = countType('2');
                const blueScore = blueCount ? 1 + blueCount * (blueCount - 1) / 2 : 0;
                const greenCount = countType('3');
                const greenScore = greenCount * (greenCount + 1) / 2;
                const orangeScore = sumType('4');
                const purpleScore = sumType('5');
                return addFoxScore(yellowScore, blueScore, greenScore, orangeScore, purpleScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('O2', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('S1', '11', '14', '17');
                tryMark('S2', '12', '15', '1A');
                tryMark('S3', '13', '18', '1B');
                tryMark('S4', '16', '19', '1C');
                tryMark('P2', '11', '15', '18', '1C');
                tryMark('x1', '11', '12', '13');
                tryMark('x2', '14', '15', '16');
                tryMark('x3', '17', '18', '19');
                tryMark('F1', '1A', '1B', '1C');
                // Blue
                tryMark('x4', '21', '22', '23');
                tryMark('x5', '24', '25', '26', '27');
                tryMark('F2', '28', '29', '2A', '2B');
                tryMark('O3', '24', '28');
                tryMark('x6', '21', '25', '29');
                tryMark('x7', '22', '26', '2A');
                tryMark('P3', '23', '27', '2B');
                // Green
                tryMark('P4', '34');
                tryMark('x8', '36');
                tryMark('F3', '37');
                tryMark('x9', '39');
                tryMark('O4', '3A');
                // Orange
                tryMark('O5', '43');
                tryMark('xa', '45');
                tryMark('P5', '46');
                tryMark('F4', '48');
                tryMark('xb', '4A');
                // Purple
                tryMark('O6', '53');
                tryMark('xc', '54');
                tryMark('P6', '55');
                tryMark('xd', '56');
                tryMark('F5', '57');
                tryMark('O7', '58');
                tryMark('xe', '59');
                tryMark('xf', '5A');
                tryMark('P7', '5B');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
            }
        };
        const board1B = {
            id: '1b',
            name: 'Clever: Challenge I',
            image: '1B.png',
            colorScheme: 'board1',
            buildBoard: (container) => {
                // Round track
                gen('r', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'cross'));
                makeMark('X0', 141.5 + 3 * 96.6, 70, 'cross');
                // Action tracks
                gen('a', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'cross'));
                makeMark('XH', 215 + 6 * 66.3 + 15, 258.5 + 30, 'cross');
                // Yellow
                gen('1', 4, 4, (x, y) => [1, 3, 0, 2][y] !== x).forEach(([id, x, y]) => makeMark(id, 65 + x * 54, 369 + y * 55.5, 'cross'));
                makeXMark('1', 290, 369 + 0 * 55.5);
                makeMark('S1', 290, 369 + 1 * 55.5, 'circle');
                makeXMark('2', 290, 369 + 2 * 55.5);
                makeMark('S2', 290, 369 + 3 * 55.5, 'circle');
                makeMark('S3', 65 + -45, 598, 'circle');
                makeMark('S4', 65 + 0 * 54, 598, 'circle');
                makeXMark('3', 65 + 1 * 54, 598);
                makeMark('P2', 65 + 2 * 54, 598, 'circle');
                makeMark('O3', 65 + 3 * 54, 598, 'circle');
                makeMark('F1', 285, 595, 'circle');
                // Blue
                gen('2', 4, 3).forEach(([id, x, y]) => makeMark(id, 378 + x * 60.7, 426 + y * 57.5, 'cross'));
                makeMark('F2', 627, 426 + 0 * 57.5, 'circle');
                makeXMark('4', 627, 426 + 1 * 57.5);
                makeXMark('5', 627, 426 + 2 * 57.5);
                makeXMark('6', 378 + 0 * 60.7, 607);
                makeXMark('7', 378 + 1 * 60.7, 607);
                makeXMark('8', 378 + 2 * 60.7, 607);
                makeMark('P3', 378 + 3 * 60.7, 607, 'circle');
                // Green
                gen('3', 11).forEach(([id, x]) => makeMark(id, 88 + x * 53.2, 709, 'cross'));
                makeMark('X9', 88 + 4 * 53.2, 739, 'cross');
                makeMark('XA', 88 + 7 * 53.2, 739, 'cross');
                // Orange
                gen('4', 11).forEach(([id, x]) => makeMark(id, 88 + x * 53.2, 811));
                makeMark('XB', 88 + 4 * 53.2, 840, 'cross');
                makeMark('XC', 88 + 9 * 53.2, 840, 'cross');
                // Purple
                gen('5', 11).forEach(([id, x]) => makeMark(id, 88 + x * 53.2, 910));
                makeMark('XD', 88 + 3 * 53.2, 940, 'cross');
                makeMark('XE', 88 + 4 * 53.2, 940, 'cross');
                makeMark('XF', 88 + 7 * 53.2, 940, 'cross');
                makeMark('XG', 88 + 9 * 53.2, 940, 'cross');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = id;
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '3' || t === '4' || t === '5') return prevMarked(id);
                if (t === '1' || t === '2') return true;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '4' || id[0] === '5',
            allowValue: (id) => id[0] === '4' || id === '51' ? allow1d() : allow1d(val => val === 6 || state.marked[prevId(id)] > val),
            writeValue: (id, val) => (({ '41': -1, '43': 2, '44': 3, '45': -1, '47': 2, '48': 3, '49': -1, '4B': 4 })[id] || 1) * val,
            score: () => {
                const yellowScore = sumType('S', (_, i) => [20, 16, 22, 12][i - 1]);
                const blueCount = Math.min(countType('2'), 11);
                const blueScore = blueCount ? 1 + blueCount * (blueCount - 1) / 2 : 0;
                const greenCount = countType('3');
                const greenScore = greenCount * (greenCount + 1) / 2;
                const orangeScore = sumType('4');
                const purpleScore = sumType('5');
                return addFoxScore(yellowScore, blueScore, greenScore, orangeScore, purpleScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('O2', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('x1', '11', '12', '13');
                tryMark('S1', '14', '15', '16');
                tryMark('x2', '17', '18', '19');
                tryMark('S2', '1A', '1B', '1C');
                tryMark('S3', '13', '16', '17', '1A');
                tryMark('S4', '11', '14', '1A');
                tryMark('x3', '15', '17', '1B');
                tryMark('P2', '12', '16', '18');
                tryMark('O3', '13', '19', '1C');
                tryMark('F1', '11', '15', '18', '1C');
                // Blue
                tryMark('F2', '21', '22', '23', '24');
                tryMark('x4', '25', '26', '27', '28');
                tryMark('x5', '29', '2A', '2B', '2C');
                tryMark('x6', '21', '25', '29');
                tryMark('x7', '22', '26', '2A');
                tryMark('x8', '23', '27', '2B');
                tryMark('P3', '24', '28', '2C');
                // Green
                tryMark('O4', '33');
                tryMark('x9', '35');
                tryMark('P4', '36');
                tryMark('xa', '38');
                tryMark('F3', '39');
                // Orange
                tryMark('P5', '43');
                tryMark('xb', '45');
                tryMark('O5', '46');
                tryMark('F4', '47');
                tryMark('xc', '4A');
                // Purple
                tryMark('O6', '53');
                tryMark('xd', '54');
                tryMark('xe', '55');
                tryMark('F5', '56');
                tryMark('P6', '57');
                tryMark('xf', '58');
                tryMark('O7', '59');
                tryMark('xg', '5A');
                tryMark('P7', '5B');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
            }
        };
        const board1B2 = {
            ...board1B,
            id: '1B',
            name: 'Clever: Challenge I ver. 2',
            image: '1B2.jpg',
            autoMark: () => {
                board1B.autoMark();
                tryMark('F0', 'a7');
                tryMark('xh', 'b7');
            },
            score: () => {
                const [yellowScore, _, greenScore, orangeScore, purpleScore] = board1B.score();
                const blueCount = countType('2');
                const blueScore = blueCount ? 1 + blueCount * (blueCount - 1) / 2 : 0;
                return addFoxScore(yellowScore, blueScore, greenScore, orangeScore, purpleScore);
            },
        }
        const board1C = {
            id: '1C',
            name: 'Clever Deluxe: Mixed',
            image: '1C.jpg',
            width: 830,
            colorScheme: 'board1',
            buildBoard: (container) => {
                // Round track
                gen('r', 6).forEach(([id, x]) => makeMark(id, 179 + x * 85.5, 37.5, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 179 + x * 85.5, 37.5, 'cross'));
                makeMark('X0', 179 + 3 * 85.5, 78, 'cross');
                // Action tracks
                gen('a', 7).forEach(([id, x]) => makeMark(id, 237 + x * 43.5, 139 + (x & 1 ? 24 : 0), 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 237 + x * 43.5, 139 + (x & 1 ? 24 : 0), 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 237 + x * 43.5, 228.5 + (x & 1 ? 24 : 0), 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 237 + x * 43.5, 228.5 + (x & 1 ? 24 : 0), 'cross'));
                gen('c', 3, 3).forEach(([id, x, y]) => makeMark(id, 648 + x * 43, 150 + y * 44.5, 'circle'));
                gen('C', 3, 3).forEach(([id, x, y]) => makeMark(id, 648 + x * 43, 150 + y * 44.5, 'cross'));
                // Yellow
                [1, 2, 3].forEach(y =>
                    gen(y.toString(), y == 1 ? 6 : 5).forEach(([id, x]) => makeMark(id, 88 + x * 52.7 + (y > 1 ? 3 : 0), 357 + (y - 1) * 72.7))
                );
                gen('s', 5).forEach(([id, x]) => makeMark(id, 88 + x * 52.7, 558, 'small', 'circle'));
                makeMark('y1', 358, 358 + 1 * 72.7);
                makeMark('y2', 358, 358 + 2 * 72.7);
                makeMark('y3', 358, 558);
                makeMark('X1', 88 + 2 * 52.7, 385 + 0 * 72.7, 'small', 'cross');
                makeMark('X2', 88 + 3 * 52.7, 385 + 0 * 72.7, 'small', 'cross');
                makeMark('X3', 88 + 5 * 52.7, 385 + 0 * 72.7, 'small', 'cross');
                makeMark('X4', 88 + 1 * 52.7, 385 + 1 * 72.7, 'small', 'cross');
                makeMark('X5', 88 + 4 * 52.7, 385 + 1 * 72.7, 'small', 'cross');
                // Blue
                gen('4', 4, 4, (x, y) => 3 - x !== y).forEach(([id, x, y]) => makeMark(id, 516.5 + x * 52.7, 354 + y * 53.5, 'cross'));
                makeXMark('6', 735, 354 + 0 * 53.5);
                makeXMark('7', 735, 354 + 1 * 53.5);
                makeXMark('8', 735, 354 + 2 * 53.5);
                makeXMark('9', 735, 354 + 3 * 53.5);
                makeMark('P3', 516.5 + 0 * 52.7, 575, 'circle');
                makeMark('Q3', 516.5 + 1 * 52.7, 575, 'circle');
                makeMark('O4', 516.5 + 2 * 52.7, 575, 'circle');
                makeMark('F2', 516.5 + 3 * 52.7, 575, 'circle');
                makeMark('P4', 731, 575, 'circle');
                // Green
                gen('5', 12).forEach(([id, x]) => makeMark(id, 115 + x * 56.3 - (x & 1 ? 3 : 0), 650));
                gen('T', 6).forEach(([id, x]) => makeMark(id, 142 + x * 112.6, 650 - 32));
                makeMark('XA', 115 + 4 * 56.3, 681, 'cross', 'small');
                makeMark('XB', 115 + 5 * 56.3 - 3, 681, 'cross', 'small');
                makeMark('XC', 115 + 9 * 56.3 - 3, 681, 'cross', 'small');
                makeMark('XD', 115 + 11 * 56.3 - 3, 681, 'cross', 'small');
                // Orange
                gen('6', 12).forEach(([id, x]) => makeMark(id, 115 + x * 56, 761, 'cross'));
                makeMark('XE', 115 + 29 + 1 * 56, 761, 'cross', 'small')
                makeMark('XF', 115 + 29 + 5 * 56, 761, 'cross', 'small')
                makeMark('XG', 115 + 29 + 7 * 56, 761, 'cross', 'small')
                makeMark('XH', 115 + 29 + 9 * 56, 761, 'cross', 'small')
                // Purple
                gen('7', 12).forEach(([id, x]) => makeMark(id, 115 + x * 56, 856));
                makeMark('XI', 115 + 2 * 56, 883, 'cross', 'small')
                makeMark('XJ', 115 + 5 * 56, 883, 'cross', 'small')
                makeMark('XK', 115 + 10 * 56, 883, 'cross', 'small')
                makeMark('XL', 115 + 11 * 56, 883, 'cross', 'small')
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R' || t === 'C' || t === 'X') return id.toLowerCase() in state.marked;
                if (t === 'c') return countType('c') < countType('Q') && (i % 3 === 1 || prevMarked(id));
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '2' || t === '3' || t === '7') return prevMarked(id);
                if (t === '4') return true;
                if (t === '1') return id[1] === '1' || state.marked[prevId(id)] > 1;
                if (t === '5') {
                    const ii = ((i - 1) >> 1 << 1) - 1;
                    return i <= 2 || (makeId('5', ii) in state.marked && makeId('5', ii + 1) in state.marked);
                }
                if (t === '6') return [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].every(k => k <= i || !(makeId('6', k) in state.marked));
                return false;
            },
            markAsValue: (id) => id[0] >= '1' && id[0] <= '3' || id[0] === '5' || id[0] === '7' || id[0] === 'y' || id[0] === 'T',
            allowValue: (id) => {
                if (id[0] === '7') {
                    const min = id == '71' ? 1 : state.marked[prevId(id)] + 1;
                    return [...Array(15)].map((_, i) => i + min);
                }
                if (id[0] === '1') return allow1d(val => id[1] === '1' || (state.marked[prevId(id)] > val));
                return allow1d();
            },
            writeValue: (id, val) => (({ '51': 2, '52': 3, '53': 2, '54': 2, '55': 2, '57': 3, '58': 2, '59': 3, '5B': 4 })[id] || 1) * val,
            score: () => {
                let yellowScore = sumType('3') - sumType('2') + (state.marked['y3'] || 0);
                const blueCount = countType('4');
                const blueScore = blueCount * (blueCount + 1) / 2;
                const greenScore = sumType('T');
                const orangeCount = countType('6');
                const orangeScore = orangeCount * (orangeCount + 1) / 2;
                const purpleCount = countType('7');
                const purpleScore = purpleCount ? 1 + purpleCount * (purpleCount - 1) / 2 + sumType('7', v => (v > 4 ? 1 : 0) + (v > 9 ? 1 : 0) + (v > 14 ? 1 : 0) + (v > 19 ? 1 : 0)) : 0;
                return addFoxScore(yellowScore, blueScore, greenScore, orangeScore, purpleScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                [..."12345"].forEach(i => tryMark('s' + i, '1' + i, '2' + i, '3' + i));
                if (countType('2')) state.marked['y1'] = sumType('2');
                if (countType('3')) state.marked['y2'] = sumType('3');
                if (countType('s')) state.marked['y3'] = sumType('s', (v, i) => v ? [10, 15, 15, 20, 20][i - 1] : 0);
                tryMark('O2', '12');
                tryMark('x1', '13');
                tryMark('x2', '14');
                tryMark('F1', '15');
                tryMark('x3', '16');
                tryMark('Q2', '21');
                tryMark('x4', '22');
                tryMark('P2', '23');
                tryMark('O3', '24');
                tryMark('x5', '25');
                // Blue
                tryMark('x6', '41', '42', '43');
                tryMark('x7', '44', '45', '46');
                tryMark('x8', '47', '48', '49');
                tryMark('x9', '4A', '4B', '4C');
                tryMark('P3', '41', '44', '47');
                tryMark('Q3', '42', '45', '4A');
                tryMark('O4', '43', '48', '4B');
                tryMark('F2', '46', '49', '4C');
                tryMark('P4', '41', '45', '48', '4C');
                // Green
                [1, 2, 3, 4, 5, 6].forEach(i => {
                    const r = makeId('T', i), a = makeId('5', 2 * i - 1), b = makeId('5', 2 * i);
                    if (a in state.marked && b in state.marked) state.marked[r] = state.marked[a] - state.marked[b];
                });
                tryMark('O5', '52');
                tryMark('P5', '54');
                tryMark('xa', '55');
                tryMark('xb', '56');
                tryMark('F3', '58');
                tryMark('Q4', '59');
                tryMark('xc', '5A');
                tryMark('xd', '5C');
                // Orange
                tryMark('Q5', '61', '62');
                tryMark('xe', '62', '63');
                tryMark('O6', '64', '65');
                tryMark('xf', '66', '67');
                tryMark('P6', '67', '68');
                tryMark('xg', '68', '69');
                tryMark('xh', '6A', '6B');
                tryMark('F4', '6B', '6C');
                // Purple
                tryMark('O7', '71');
                tryMark('xi', '73');
                tryMark('Q6', '74');
                tryMark('xj', '76');
                tryMark('Q7', '77');
                tryMark('P7', '78');
                tryMark('F5', '7A');
                tryMark('xk', '7B');
                tryMark('xl', '7C');
                // Bonus tracks
                bonusMark('O', 'a');
                tryMark('F0', 'a7');
                bonusMark('P', 'b');
            }
        }
        const board2A = {
            id: '2A',
            name: 'Twice as Clever',
            image: '2A.png',
            colorScheme: 'board2',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 74, 'cross');
                // Action tracks (ABC)
                gen('a', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'circle'));
                gen('A', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'cross'));
                gen('c', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'circle'));
                gen('C', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'cross'));
                gen('b', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'circle'));
                gen('B', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 218, 'cross', 'small');
                makeMark('X2', 261 + 5 * 70.3 + 22, 218 + 67.5, 'cross', 'small');
                // Silver (1234)
                [1, 2, 3, 4].forEach(y =>
                    gen(y.toString(), 6).forEach(([id, x]) => makeMark(id, 37 + x * 50.8, 415 + (y - 1) * 49.5, 'cross'))
                );
                makeMark('P2', 37 + 0 * 50.8, 351, 'circle');
                makeXMark('3', 37 + 1 * 50.8, 351);
                makeMark('F1', 37 + 2 * 50.8, 351, 'circle');
                makeXMark('4', 37 + 3 * 50.8, 351);
                makeXMark('5', 37 + 4 * 50.8, 351);
                makeXMark('6', 37 + 5 * 50.8, 351);
                // Yellow (56)
                gen('5', 2, 3).forEach(([id, x, y]) => makeMark(id, 454 + x * 112, 415 + y * 64, 'circle'));
                gen('6', 2, 3).forEach(([id, x, y]) => makeMark(id, 454 + x * 112, 415 + y * 64, 'cross'));
                gen('57', 2, 2).forEach(([id, x, y]) => makeMark(id, 399 + x * 112, 448 + y * 64, 'circle'));
                gen('67', 2, 2).forEach(([id, x, y]) => makeMark(id, 399 + x * 112, 448 + y * 64, 'cross'));
                makeXMark('7', 627, 416 + 0 * 32, 'small');
                makeMark('Q2', 627, 416 + 1 * 32, 'small', 'circle');
                makeXMark('8', 627, 416 + 2 * 32, 'small');
                makeXMark('9', 627, 416 + 3 * 32, 'small');
                makeXMark('a', 627, 416 + 4 * 32, 'small');
                makeMark('O2', 399 + 0 * 56, 603, 'circle');
                makeMark('P3', 399 + 1 * 56, 603, 'circle');
                makeXMark('b', 399 + 2 * 56, 603);
                makeMark('F2', 399 + 3 * 56, 603, 'circle');
                // Blue (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 72 + x * 49.9, 703.5));
                makeMark('XC', 72 + 2 * 49.9, 731, 'cross', 'small');
                makeMark('XD', 72 + 6 * 49.9, 731, 'cross', 'small');
                makeMark('XE', 72 + 11 * 49.9, 731, 'cross', 'small');
                // Green (8)
                gen('8', 12).forEach(([id, x]) => makeMark(id, 72 + x * 49.9, 804));
                gen('T', 6).forEach(([id, x]) => makeMark(id, 72 + (2 * x + .5) * 49.9, 804 - 24, 'small'));
                makeMark('XF', 72 + 3 * 49.9, 832, 'cross', 'small');
                makeMark('XG', 72 + 7 * 49.9, 832, 'cross', 'small');
                makeMark('XH', 72 + 10 * 49.9, 832, 'cross', 'small');
                makeMark('XI', 72 + 11 * 49.9, 832, 'cross', 'small');
                // Pink (9)
                gen('9', 12).forEach(([id, x]) => makeMark(id, 72 + x * 49.9, 900.5));
                gen('U3', 10).forEach(([id, x]) => makeMark(id, 72 + (x + 2) * 49.9, 925.5, 'small', 'redcross'));
                makeMark('XJ', 72 + 5 * 49.9, 926, 'cross', 'small');
                makeMark('XK', 72 + 6 * 49.9, 926, 'cross', 'small');
                makeMark('XL', 72 + 8 * 49.9, 926, 'cross', 'small');
                makeMark('XM', 72 + 10 * 49.9, 926, 'cross', 'small');
                makeMark('XN', 72 + 11 * 49.9, 926, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = id;
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B' || t === 'C') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '7' || t === '8' || t === '9') return prevMarked(id);
                if (t >= '1' && t <= '5') return true;
                if (t === '6') return ('5' + i) in state.marked;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '7' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id) => {
                if (id[0] !== '7') return allow1d();
                return allow2d(val => id === '71' || state.marked[prevId(id)] >= val);
            },
            writeValue: (id, val) => (({ '81': 2, '82': 2, '83': 2, '85': 3, '86': 3, '87': 3, '88': 2, '89': 3, '8B': 4 })[id] || 1) * val,
            score: () => {
                const silverScore = [..."1234"].reduce((a, i) => a + [0, 2, 4, 7, 11, 16, 22][countType(i)], 0);
                const yellowScore = [0, 3, 10, 21, 36, 55, 75, 96, 118, 141, 165][countType('6')];
                const blueCount = countType('7');
                const blueScore = blueCount * (blueCount + 1) / 2;
                const greenScore = sumType('T');
                const pinkScore = sumType('9');
                return addFoxScore(silverScore, yellowScore, blueScore, greenScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Silver
                tryMark('P2', '11', '21', '31', '41');
                tryMark('x3', '12', '22', '32', '42');
                tryMark('F1', '13', '23', '33', '43');
                tryMark('x4', '14', '24', '34', '44');
                tryMark('x5', '15', '25', '35', '45');
                tryMark('x6', '16', '26', '36', '46');
                // Yellow
                tryMark('x7', '51', '52');
                tryMark('Q2', '57', '58');
                tryMark('x8', '53', '54');
                tryMark('x9', '59', '5A');
                tryMark('xa', '55', '56');
                tryMark('O2', '57', '59');
                tryMark('P3', '51', '53', '55');
                tryMark('xb', '58', '5A');
                tryMark('F2', '52', '54', '56');
                // Blue
                tryMark('Q3', '72');
                tryMark('xc', '73');
                tryMark('P4', '75');
                tryMark('O3', '76');
                tryMark('xd', '77');
                tryMark('F3', '79');
                tryMark('Q4', '7A');
                tryMark('xe', '7C');
                // Green
                [1, 2, 3, 4, 5, 6].forEach(i => {
                    const r = makeId('T', i), a = makeId('8', 2 * i - 1), b = makeId('8', 2 * i);
                    if (a in state.marked && b in state.marked) state.marked[r] = state.marked[a] - state.marked[b];
                });
                tryMark('O4', '82');
                tryMark('xf', '84');
                tryMark('Q5', '85');
                tryMark('F4', '87');
                tryMark('xg', '88');
                tryMark('P5', '89');
                tryMark('xh', '8B');
                tryMark('xi', '8C');
                // Pink
                tryMarkMin('O5', '93', 2, 'U3');
                tryMarkMin('Q6', '94', 3, 'U4');
                tryMarkMin('P6', '95', 4, 'U5');
                tryMarkMin('xj', '96', 5, 'U6');
                tryMarkMin('xk', '97', 6, 'U7');
                tryMarkMin('F5', '98', 2, 'U8');
                tryMarkMin('xl', '99', 3, 'U9');
                tryMarkMin('O6', '9A', 4, 'UA');
                tryMarkMin('xm', '9B', 5, 'UB');
                tryMarkMin('xn', '9C', 6, 'UC');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('F0', 'a6');
                tryMark('x2', 'b6');
                tryMark('x1', 'c6');
            }
        };
        const board2B = {
            id: '2B',
            name: 'Twice as Clever: Challenge I',
            image: '2B.png',
            colorScheme: 'board2',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 74, 'cross');
                // Action tracks (ABC)
                gen('c', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'circle'));
                gen('C', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'cross'));
                gen('a', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'circle'));
                gen('A', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'cross'));
                gen('b', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'circle'));
                gen('B', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 218 - 67.5, 'cross', 'small');
                makeMark('X2', 261 + 5 * 70.3 + 22, 218 + 67.5, 'cross', 'small');
                // Silver (1234)
                [1, 2, 3, 4].forEach(y =>
                    gen(y.toString(), 7).forEach(([id, x]) => makeMark(id, 30 + x * 51.7, 413 + (y - 1) * 49.5, 'cross'))
                );
                makeMark('Q2', 30 + 0 * 51.7, 349, 'circle');
                makeMark('F1', 30 + 1 * 51.7, 349, 'circle');
                makeXMark('3', 30 + 2 * 51.7, 349);
                makeMark('P2', 30 + 3 * 51.7, 349, 'circle');
                makeXMark('4', 30 + 4 * 51.7, 349);
                makeXMark('5', 30 + 5 * 51.7, 349);
                makeXMark('6', 30 + 6 * 51.7, 349);
                // Yellow (56)
                gen('5', 3, 4).forEach(([id, x, y]) => makeMark(id, 445 + x * 56, 412 + y * 45, 'small', [2, 1, 2, 0][y] == x ? 'small' : 'circle'));
                gen('6', 3, 4).forEach(([id, x, y]) => makeMark(id, 445 + x * 56, 412 + y * 45, 'cross'));
                makeMark('O2', 620, 412 + 0 * 45, 'circle');
                makeXMark('7', 620, 412 + 1 * 45);
                makeXMark('8', 620, 412 + 2 * 45);
                makeXMark('9', 620, 412 + 3 * 45);
                makeMark('P3', 445 + 0 * 56, 603, 'circle');
                makeMark('F2', 445 + 1 * 56, 603, 'circle');
                makeXMark('a', 445 + 2 * 56, 603);
                // Blue (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 67 + x * 50.4, 703.5));
                makeMark('XB', 67 + 2 * 50.4, 733, 'cross', 'small');
                makeMark('XC', 67 + 4 * 50.4, 733, 'cross', 'small');
                makeMark('XD', 67 + 8 * 50.4, 733, 'cross', 'small');
                makeMark('XE', 67 + 11 * 50.4, 733, 'cross', 'small');
                // Green (8)
                gen('8', 12).forEach(([id, x]) => makeMark(id, 31 + x * 54 - (x & 1 ? 3 : 0), 806));
                gen('T', 6).forEach(([id, x]) => makeMark(id, 56 + x * 108, 804 - 22, 'small'));
                makeMark('XF', 31 + 2 * 54, 835, 'cross', 'small');
                makeMark('XG', 31 + 5 * 54 - 3, 835, 'cross', 'small');
                makeMark('XH', 31 + 9 * 54 - 3, 835, 'cross', 'small');
                makeMark('XI', 31 + 10 * 54, 835, 'cross', 'small');
                // Pink (9)
                gen('9', 12).forEach(([id, x]) => makeMark(id, 67 + x * 50.4, 904.5));
                gen('U', 12).forEach(([id, x]) => makeMark(id, 67 + x * 50.4, 929.5, 'small', 'redcross'));
                makeMark('XJ', 67 + 2 * 50.4, 929.5, 'cross', 'small');
                makeMark('XK', 67 + 4 * 50.4, 929.5, 'cross', 'small');
                makeMark('XL', 67 + 7 * 50.4, 929.5, 'cross', 'small');
                makeMark('XM', 67 + 10 * 50.4, 929.5, 'cross', 'small');
                makeMark('XN', 67 + 11 * 50.4, 929.5, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B' || t === 'C') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '7' || t === '9') return prevMarked(id);
                if (t === '8') {
                    const ii = ((i - 1) >> 1 << 1) - 1;
                    return i <= 2 || (makeId('8', ii) in state.marked && makeId('8', ii + 1) in state.marked);
                }
                if (t >= '1' && t <= '5') return true;
                if (t === '6') return makeId('5', i) in state.marked;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '7' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id) => {
                if (id[0] !== '7') return allow1d();
                return allow2d(val => id === '71' || state.marked[prevId(id)] <= val);
            },
            writeValue: (id, val) => (({ '81': 2, '82': 2, '83': 2, '85': 3, '86': 3, '87': 3, '88': 2, '89': 3, '8B': 4 })[id] || 1) * val,
            score: () => {
                const silverScore = [..."1234"].reduce((a, i) => a + [0, 2, 5, 9, 14, 20, 27, 35][countType(i)], 0);
                const yellowScore = [0, 1, 6, 15, 28, 43, 59, 76, 94, 113, 133, 154, 176][countType('6')];
                const blueCount = countType('7');
                const blueScore = blueCount * (blueCount + 1) / 2;
                const greenScore = sumType('T');
                const pinkScore = sumType('9');
                return addFoxScore(silverScore, yellowScore, blueScore, greenScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Silver
                tryMark('Q2', '11', '21', '31', '41');
                tryMark('F1', '12', '22', '32', '42');
                tryMark('x3', '13', '23', '33', '43');
                tryMark('P2', '14', '24', '34', '44');
                tryMark('x4', '15', '25', '35', '45');
                tryMark('x5', '16', '26', '36', '46');
                tryMark('x6', '17', '27', '37', '47');
                // Yellow
                tryMark('53');
                tryMark('55');
                tryMark('59');
                tryMark('5A');

                tryMark('O2', '51', '52', '53');
                tryMark('x7', '54', '55', '56');
                tryMark('x8', '57', '58', '59');
                tryMark('x9', '5A', '5B', '5C');

                tryMark('P3', '51', '54', '57', '5A');
                tryMark('F2', '52', '55', '58', '5B');
                tryMark('xa', '53', '56', '59', '5C');
                // Blue
                tryMark('O3', '72');
                tryMark('xb', '73');
                tryMark('Q3', '74');
                tryMark('xc', '75');
                tryMark('P4', '77');
                tryMark('F3', '78');
                tryMark('xd', '79');
                tryMark('O4', '7B');
                tryMark('xe', '7C');
                // Green
                [1, 2, 3, 4, 5, 6].forEach(i => {
                    const r = makeId('T', i), a = makeId('8', 2 * i - 1), b = makeId('8', 2 * i);
                    if (a in state.marked && b in state.marked) state.marked[r] = state.marked[a] - state.marked[b];
                });
                tryMark('Q4', '82');
                tryMark('xf', '83');
                tryMark('P5', '84');
                tryMark('xg', '86');
                tryMark('O5', '87');
                tryMark('F4', '88');
                tryMark('xh', '8A');
                tryMark('xi', '8B');
                // Pink
                tryMarkMin('O6', '91', 2, 'U1');
                tryMarkMin('Q5', '92', 3, 'U2');
                tryMarkMin('xj', '93', 4, 'U3');
                tryMarkMin('xk', '95', 5, 'U5');
                tryMarkMin('P6', '96', 4, 'U6');
                tryMarkMin('F5', '97', 3, 'U7');
                tryMarkMin('xl', '98', 2, 'U8');
                tryMarkMin('Q6', '9A', 3, 'UA');
                tryMarkMin('xm', '9B', 4, 'UB');
                tryMarkMin('xn', '9C', 5, 'UC');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('F0', 'a6');
                tryMark('x2', 'b6');
                tryMark('x1', 'c6');
            }
        };
        const board3A = {
            id: '3A',
            name: 'Clever Cubed',
            image: '3A.jpg',
            colorScheme: 'board3',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 30, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 30, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 71.5, 'cross');
                // Action tracks (ABC)
                gen('a', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 136.5, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 136.5, 'cross'));
                gen('c', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204, 'circle'));
                gen('C', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204 + 67.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 215.5, 'cross', 'small');
                makeMark('X2', 261 + 5 * 70.3 + 22, 215.5 + 67.5, 'cross', 'small');
                // Yellow (123)
                [1, 2, 3].forEach(y =>
                    gen(y.toString(), 6).forEach(([id, x]) => makeMark(id, 64 + x * 47, 401.5 + (y - 1) * 91, 'cross'))
                );
                makeMark('O2', 64 + 0 * 47, 401.5 + 45.5, 'circle', 'small');
                makeMark('Q2', 64 + 1 * 47, 401.5 + 45.5, 'circle', 'small');
                makeXMark('3', 64 + 2 * 47, 401.5 + 45.5, 'small');
                makeMark('P2', 64 + 3 * 47, 401.5 + 45.5, 'circle', 'small');
                makeXMark('4', 64 + 4 * 47, 401.5 + 45.5, 'small');
                makeMark('F1', 64 + 5 * 47, 401.5 + 45.5, 'circle', 'small');
                makeMark('Q3', 64 + 0 * 47, 401.5 + 45.5 + 91, 'circle', 'small');
                makeXMark('5', 64 + 1 * 47, 401.5 + 45.5 + 91, 'small');
                makeXMark('6', 64 + 2 * 47, 401.5 + 45.5 + 91, 'small');
                makeXMark('7', 64 + 3 * 47, 401.5 + 45.5 + 91, 'small');
                makeXMark('8', 64 + 4 * 47, 401.5 + 45.5 + 91, 'small');
                makeMark('P3', 64 + 5 * 47, 401.5 + 45.5 + 91, 'circle', 'small');
                // Teal (4)
                gen('4', 6, 5).forEach(([id, x, y]) => makeMark(id, 381.5 + x * 41.1, 390 + y * 40.5, 'cross', 'small'));
                makeMark('F2', 635, 390 + 0 * 40.5, 'small', 'circle')
                makeMark('P4', 635, 390 + 1 * 40.5, 'small', 'circle')
                makeXMark('9', 635, 390 + 2 * 40.5, 'small')
                makeXMark('a', 635, 390 + 3 * 40.5, 'small')
                makeXMark('b', 381.5 + 0 * 41.1, 600, 'small');
                makeXMark('c', 381.5 + 1 * 41.1, 600, 'small');
                makeXMark('d', 381.5 + 2 * 41.1, 600, 'small');
                makeMark('Q4', 381.5 + 3 * 41.1, 600, 'small', 'circle');
                makeXMark('e', 381.5 + 4 * 41.1, 600, 'small');
                makeMark('O3', 381.5 + 5 * 41.1, 600, 'small', 'circle');
                // Blue (56)
                gen('5', 6).forEach(([id, x]) => makeMark(id, 33 + (5 - x) * 49, 676));
                gen('6', 6).forEach(([id, x]) => makeMark(id, 33 + (7 + x) * 49, 676));
                makeMark('XF', 33 + 3 * 49, 703, 'cross', 'small');
                makeMark('XG', 33 + 1 * 49, 703, 'cross', 'small');
                makeMark('XH', 33 + 9 * 49, 703, 'cross', 'small');
                makeMark('XI', 33 + 11 * 49, 703, 'cross', 'small');
                // Brown (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 70 + x * 50.1, 817, 'cross'));
                makeMark('XJ', 95 + 1 * 50.1, 817, 'cross', 'small')
                makeMark('XK', 95 + 4 * 50.1, 817, 'cross', 'small')
                makeMark('XL', 95 + 7 * 50.1, 817, 'cross', 'small')
                makeMark('XM', 95 + 9 * 50.1, 817, 'cross', 'small')
                // Pink (89)
                gen('92', 11).forEach(([id, x]) => makeMark(id, 70 + (x + 1) * 50.1, 899 - 32, 'hide'));
                gen('8', 12).forEach(([id, x]) => makeMark(id, 70 + x * 50.1, 899));
                gen('U2', 11).forEach(([id, x]) => makeMark(id, 70 + (x + 1) * 50.1, 924, 'small', 'redcross'));
                gen('T2', 11).forEach(([id, x]) => makeMark(id, 70 + (x + 1) * 50.1, 899));
                makeMark('XN', 70 + 2 * 50.1, 924, 'cross', 'small');
                makeMark('XO', 70 + 5 * 50.1, 924, 'cross', 'small');
                makeMark('XP', 70 + 6 * 50.1, 924, 'cross', 'small');
                makeMark('XQ', 70 + 9 * 50.1, 924, 'cross', 'small');
                makeMark('XR', 70 + 10 * 50.1, 924, 'cross', 'small');
                makeMark('XS', 70 + 11 * 50.1, 924, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R' || t === 'C' || t === 'X') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t >= '1' && t <= '4') return true;
                if (t === '5' || t === '6') return prevMarked(id);
                if (t === '7') return [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].every(k => k <= i || !(makeId('7', k) in state.marked));
                if (t === '8' || t === '9')
                    return (i === 1 || makeId('8', i - 1) in state.marked || makeId('9', i - 1) in state.marked) &&
                        !(makeId(t === '8' ? '9' : '8', i) in state.marked);
                return false;
            },
            markAsValue: (id) => id[0] === '5' || id[0] === '6' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id) => {
                if (id[0] !== '5' && id[0] !== '6') return allow1d();
                const prev = prevId(id);
                const prevVal = prev ? state.marked[prev] : 7;
                const reqVal = prevVal + (id[0] === '5' ? -1 : 1);
                return reqVal === 7 ? [7] : [Math.min(reqVal, 7), Math.max(reqVal, 7)];
            },
            writeValue: (id, val) => id[0] === '8' ? [1, 1, 2, 2, 3, 3][val - 1] : (({ '93': 2, '94': 2, '96': 2, '97': 2, '99': 3, '9A': 2, '9B': 2, '9C': 3 })[id] || 1) * val,
            score: () => {
                const yellowScore = [..."123"].reduce((a, i) => a + [0, 2, 6, 12, 20, 30, 42][countType(i)], 0);
                const tealScore = [0, 1, 2, 3, 4].reduce((a, i) => a + (
                    [0, 1, 3, 6, 10, 15, 21][[0, 1, 2, 3, 4, 5].filter(j => makeId('4', i * 6 + j + 1) in state.marked).length]
                ), 0);
                const blueCount = countType('7');
                const blueScore = ["5", "6"].reduce((a, v) => a + [0, 3, 6, 9, 13, 17, 22][countType(v)] +
                    [..."123456"].reduce((a, i) => a + (state.marked[v + i] < 5 || state.marked[v + i] > 9 ? 4 : 0), 0),
                    0);
                const brownCount = countType('7');
                const brownScore = (brownCount + 1) * (brownCount + 2) / 2 - 1;
                const pinkScore = sumType('8') + sumType('9');
                return addFoxScore(yellowScore, tealScore, blueScore, brownScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('O2', '11', '21');
                tryMark('Q2', '12', '22');
                tryMark('x3', '13', '23');
                tryMark('P2', '14', '24');
                tryMark('x4', '15', '25');
                tryMark('F1', '16', '26');
                tryMark('Q3', '21', '31');
                tryMark('x5', '22', '32');
                tryMark('x6', '23', '33');
                tryMark('x7', '24', '34');
                tryMark('x8', '25', '35');
                tryMark('P3', '26', '36');
                // Teal
                tryMark('F2', '41', '42', '43', '44', '45', '46');
                tryMark('P4', '47', '48', '49', '4A', '4B'); // C
                tryMark('x9', '4D', '4E', '4F'); // GHI
                tryMark('xa', '4J', '4K'); // LMNO
                tryMark('xb', '41', '47', '4D', '4J', '4P');
                tryMark('xc', '42', '48', '4E', '4K');
                tryMark('xd', '43', '49', '4F');
                tryMark('Q4', '44', '4A');
                tryMark('xe', '45', '4B');
                tryMark('O3', '46');
                // Blue
                tryMark('Q5', '52');
                tryMark('xf', '53');
                tryMark('xg', '55');
                tryMark('P5', '56');
                tryMark('O4', '62');
                tryMark('xh', '63');
                tryMark('xi', '65');
                tryMark('F3', '66');
                // Brown
                tryMark('Q6', '71', '72');
                tryMark('xj', '72', '73');
                tryMark('O5', '75', '75');
                tryMark('xk', '75', '76');
                tryMark('P6', '77', '78');
                tryMark('xl', '78', '79');
                tryMark('xm', '7A', '7B');
                tryMark('F4', '7B', '7C');
                // Pink
                for (let i = 2; i <= 12; i++) if (makeId('9', i) in state.marked) {
                    state.marked[makeId('U', i)] = true;
                    state.marked[makeId('T', i)] = state.marked[makeId('9', i)];
                }
                tryMark('O6', '82');
                tryMark('xn', '83');
                tryMark('P7', '84');
                tryMark('Q7', '85');
                tryMark('xo', '86');
                tryMark('xp', '87');
                tryMark('O7', '88');
                tryMark('F5', '89');
                tryMark('xq', '8A');
                tryMark('xr', '8B');
                tryMark('xs', '8C');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('F0', 'a7');
                tryMark('x2', 'b7');
                tryMark('x1', 'c7');
            }
        };
        const board3B = {
            id: '3B',
            name: 'Clever Cubed: Challenge I',
            image: '3B.png',
            colorScheme: 'board3',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 30, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 30, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 71.5, 'cross');
                // Action tracks (ABC)
                gen('c', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 136.5, 'circle'));
                gen('C', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 136.5, 'cross'));
                gen('a', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204 + 67.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 215.5 + 67.5, 'cross', 'small');
                // Yellow (123)
                [1, 2, 3].forEach(y =>
                    gen(y.toString(), 6).forEach(([id, x]) => makeMark(id, 56 + x * 47, 393 + (y - 1) * 80, 'cross'))
                );
                makeMark('O2', 56 + 0 * 47, 393 + 40, 'circle', 'small');
                makeMark('Q2', 56 + 1 * 47, 393 + 40, 'circle', 'small');
                makeXMark('2', 56 + 2 * 47, 393 + 40, 'small');
                makeXMark('3', 56 + 3 * 47, 393 + 40, 'small');
                makeMark('F1', 56 + 4 * 47, 393 + 40, 'circle', 'small');
                makeXMark('4', 56 + 5 * 47, 393 + 40, 'small');
                makeMark('O3', 56 + 0 * 47, 393 + 40 + 80, 'circle', 'small');
                makeXMark('5', 56 + 1 * 47, 393 + 40 + 80, 'small');
                makeMark('P2', 56 + 2 * 47, 393 + 40 + 80, 'circle', 'small');
                makeXMark('6', 56 + 3 * 47, 393 + 40 + 80, 'small');
                makeXMark('7', 56 + 4 * 47, 393 + 40 + 80, 'small');
                makeMark('Q3', 56 + 5 * 47, 393 + 40 + 80, 'circle', 'small');
                // Teal (4)
                gen('4', 6, 5).forEach(([id, x, y]) => makeMark(id, 381.5 + x * 41.1, 390 + y * 40.5, 'cross', 'small'));
                makeXMark('8', 635, 390 + 0 * 40.5, 'small')
                makeXMark('9', 635, 390 + 1 * 40.5, 'small')
                makeXMark('a', 635, 390 + 2 * 40.5, 'small')
                makeXMark('b', 635, 390 + 3 * 40.5, 'small')
                makeMark('O4', 381.5 + 0 * 41.1, 600, 'small', 'circle');
                makeMark('P3', 381.5 + 1 * 41.1, 600, 'small', 'circle');
                makeMark('Q4', 381.5 + 2 * 41.1, 600, 'small', 'circle');
                makeXMark('c', 381.5 + 3 * 41.1, 600, 'small');
                makeXMark('d', 381.5 + 4 * 41.1, 600, 'small');
                makeMark('F2', 381.5 + 5 * 41.1, 600, 'small', 'circle');
                // Blue (56)
                gen('5', 6).forEach(([id, x]) => makeMark(id, 33 + (5 - x) * 49, 676));
                gen('6', 6).forEach(([id, x]) => makeMark(id, 33 + (7 + x) * 49, 676));
                makeMark('XE', 33 + 4 * 49, 703, 'cross', 'small');
                makeMark('XF', 33 + 2 * 49, 703, 'cross', 'small');
                makeMark('XG', 33 + 0 * 49, 703, 'cross', 'small');
                makeMark('XH', 33 + 10 * 49, 703, 'cross', 'small');
                // Brown (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 70 + x * 50.1, 817, 'cross'));
                makeMark('XI', 95 + 1 * 50.1, 817, 'cross', 'small')
                makeMark('XJ', 95 + 3 * 50.1, 817, 'cross', 'small')
                makeMark('XK', 95 + 7 * 50.1, 817, 'cross', 'small')
                makeMark('XL', 95 + 10 * 50.1, 817, 'cross', 'small')
                // Pink (89)
                gen('9', 12).forEach(([id, x]) => [3, 6, 10].includes(x) || makeMark(id, 70 + x * 50.1, 899 - 32, 'hide'));
                gen('8', 12).forEach(([id, x]) => makeMark(id, 70 + x * 50.1, 899));
                gen('U', 12).forEach(([id, x]) => [3, 6, 10].includes(x) || makeMark(id, 70 + x * 50.1, 924, 'small', 'redcross'));
                gen('T', 12).forEach(([id, x]) => [3, 6, 10].includes(x) || makeMark(id, 70 + x * 50.1, 899));
                makeMark('XM', 70 + 1 * 50.1, 924, 'cross', 'small');
                makeMark('XN', 70 + 2 * 50.1, 924, 'cross', 'small');
                makeMark('XO', 70 + 5 * 50.1, 924, 'cross', 'small');
                makeMark('XP', 70 + 9 * 50.1, 924, 'cross', 'small');
                makeMark('XQ', 70 + 11 * 50.1, 924, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R' || t === 'C' || t === 'X') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t >= '1' && t <= '4') return true;
                if (t === '5' || t === '6') return prevMarked(id);
                if (t === '7') return [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].every(k => k <= i || !(makeId('7', k) in state.marked));
                if (t === '8' || t === '9')
                    return (i === 1 || makeId('8', i - 1) in state.marked || makeId('9', i - 1) in state.marked) &&
                        !(makeId(t === '8' ? '9' : '8', i) in state.marked);
                return false;
            },
            markAsValue: (id) => id[0] === '5' || id[0] === '6' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id) => {
                if (id[0] !== '5' && id[0] !== '6') return allow1d();
                const [t, i] = parseId(id);
                const prev = prevId(id);
                const prevVal = prev ? state.marked[prev] : 7;
                const reqVal = prevVal + (t === '5' ? -1 : 1) * [1, 2, 2, -2, -2, -1][i - 1];
                return reqVal === 7 ? [7] : [Math.min(reqVal, 7), Math.max(reqVal, 7)];
            },
            writeValue: (id, val) => id == '84' ? val + 3 : id === '87' ? val + 4 : id === '8B' ? val + 5 :
                id[0] === '8' ? [1, 1, 2, 2, 3, 3][val - 1] : (({ '92': 2, '93': 2, '96': 2, '98': 2, '99': 4, '9A': 2, '9C': 3 })[id] || 1) * val,
            score: () => {
                const yellowScore = [..."123"].reduce((a, i) => a + [0, 2, 6, 12, 20, 30, 42][countType(i)], 0) + countType('S') * 3;
                const tealScore = [0, 1, 2, 3, 4].reduce((a, i) => a + (
                    [0, 1, 3, 6, 10, 15, 21][[0, 1, 2, 3, 4, 5].filter(j => makeId('4', i * 6 + j + 1) in state.marked).length]
                ), 0) + [..."1347CFHMNPRTU"].filter(i => ('4' + i) in state.marked).length * 4;
                const blueCount = countType('7');
                const blueScore = ["5", "6"].reduce((a, v) => a + [0, 3, 6, 9, 13, 17, 22][countType(v)] +
                    [..."123456"].reduce((a, i) => a + (state.marked[v + i] < 5 || state.marked[v + i] > 9 ? 6 : 0), 0),
                    0);
                const brownCount = countType('7');
                const brownScore = (brownCount + 1) * (brownCount + 2) / 2 - 1 +
                    (state.marked['73'] && state.marked['74'] ? 2 : 0) +
                    (state.marked['76'] && state.marked['77'] ? 3 : 0) +
                    (state.marked['79'] && state.marked['7A'] ? 4 : 0);
                const pinkScore = sumType('8') + sumType('9');
                return addFoxScore(yellowScore, tealScore, blueScore, brownScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('O2', '11', '21');
                tryMark('Q2', '12', '22');
                tryMark('x2', '13', '23');
                tryMark('x3', '14', '24');
                tryMark('F1', '15', '25');
                tryMark('x4', '16', '26');
                tryMark('O3', '21', '31');
                tryMark('x5', '22', '32');
                tryMark('P2', '23', '33');
                tryMark('x6', '24', '34');
                tryMark('x7', '25', '35');
                tryMark('Q3', '26', '36');
                [..."123456"].forEach(i => tryMark('S' + i, '1' + i, '2' + i, '3' + i));
                // Teal
                // 123456 _#__## _2__56
                // 789ABC _####_ _89AB_
                // DEFGHI ##_#_# DE_G_I
                // JKLMNO ###__# JKL__O
                // PQRSTU _#_#__ _Q_S__
                tryMark('x8', '42', '45', '46');
                tryMark('x9', '48', '49', '4A', '4B');
                tryMark('xa', '4D', '4E', '4G', '4I');
                tryMark('xb', '4J', '4K', '4L', '4O');
                tryMark('O4', '4D', '4J');
                tryMark('P3', '42', '48', '4E', '4K', '4Q');
                tryMark('Q4', '49', '4L');
                tryMark('xc', '4A', '4G', '4S');
                tryMark('xd', '45', '4B');
                tryMark('F2', '46', '4I', '4O');
                // Blue
                tryMark('xe', '52');
                tryMark('xf', '54');
                tryMark('F3', '55');
                tryMark('xg', '56');
                tryMark('O5', '61');
                tryMark('Q5', '62');
                tryMark('xh', '64');
                tryMark('P4', '66');
                // Brown
                tryMark('O6', '71', '72');
                tryMark('xi', '72', '73');
                tryMark('xj', '75', '75');
                tryMark('P5', '75', '76');
                tryMark('Q6', '77', '78');
                tryMark('xk', '78', '79');
                tryMark('F4', '7A', '7B');
                tryMark('xl', '7B', '7C');
                // Pink
                for (let i = 1; i <= 12; i++) if (makeId('9', i) in state.marked) {
                    state.marked[makeId('U', i)] = true;
                    state.marked[makeId('T', i)] = state.marked[makeId('9', i)];
                }
                tryMark('Q7', '81');
                tryMark('xm', '82');
                tryMark('xn', '83');
                tryMark('O7', '85');
                tryMark('xo', '86');
                tryMark('P6', '88');
                tryMark('F5', '89');
                tryMark('xp', '8A');
                tryMark('xq', '8C');
                // Bonus tracks
                bonusMark('O', 'a');
                tryMark('P7', 'a7');
                bonusMark('P', 'b');
                tryMark('x1', 'b7');
                bonusMark('Q', 'c');
                tryMark('F0', 'c7');
            }
        };
        const board4A = {
            id: '4A',
            name: 'Clever 4Ever',
            image: '4A.png',
            colorScheme: 'board4',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 149 + x * 96.5, 18, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 149 + x * 96.5, 18, 'cross'));
                makeMark('X0', 149 + 3 * 96.5, 60, 'cross');
                // Action tracks (ABC)
                gen('a', 7).forEach(([id, x]) => makeMark(id, 189 + x * 36.9, 124 + (x & 1) * 25, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 189 + x * 36.9, 124 + (x & 1) * 25, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 189 + x * 36.9, 216 + (x & 1) * 25, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 189 + x * 36.9, 216 + (x & 1) * 25, 'cross'));
                gen('c', 3, 3).forEach(([id, x, y]) => makeMark(id, 535 + x * 44, 135 + y * 46, 'circle'));
                gen('C', 3, 3).forEach(([id, x, y]) => makeMark(id, 535 + x * 44, 135 + y * 46, 'cross'));
                makeMark('X1', 425, 140, 'cross', 'small');
                // Yellow (123sy)
                [1, 2, 3].forEach(y =>
                    gen(y.toString(), 5).forEach(([id, x]) => makeMark(id, 67 + x * 47 + (y > 1 ? 3 : 0), 339 + (y - 1) * 70))
                );
                gen('s', 5).forEach(([id, x]) => makeMark(id, 67 + x * 47, 339 + 190, 'small', 'circle'));
                makeMark('y1', 297, 338 + 1 * 70, 'small');
                makeMark('y2', 297, 338 + 2 * 70, 'small');
                makeMark('y3', 297, 338 + 190, 'small');
                makeMark('X2', 67 + 2 * 47, 366 + 0 * 70, 'small', 'cross');
                makeMark('X3', 67 + 3 * 47, 366 + 0 * 70, 'small', 'cross');
                makeMark('X4', 67 + 1 * 47, 366 + 1 * 70, 'small', 'cross');
                makeMark('X5', 67 + 2 * 47, 366 + 1 * 70, 'small', 'cross');
                makeMark('X6', 67 + 4 * 47, 366 + 1 * 70, 'small', 'cross');
                // Blue (4S)
                gen('40', 6, 6).forEach(([id, x, y]) => makeMark(id, 407.5 + x * 38, 309 + y * 38, 'cross', 'small'));
                makeXMark('7', 407.5 + 6 * 38 + 5, 309 + 0 * 38, 'small');
                makeXMark('8', 407.5 + 6 * 38 + 5, 309 + 1 * 38, 'small');
                makeXMark('9', 407.5 + 6 * 38 + 5, 309 + 2 * 38, 'small');
                makeMark('P3', 407.5 + 6 * 38 + 5, 309 + 3 * 38, 'small', 'circle');
                makeXMark('a', 407.5 + 6 * 38 + 5, 309 + 4 * 38, 'small');
                makeMark('F2', 407.5 + 6 * 38 + 5, 309 + 5 * 38, 'small', 'circle');
                makeMark('O3', 407.5 + 6 * 38, 309 + 6 * 38, 'small', 'circle');
                gen('S', 6).forEach(([id, x]) => makeMark(id, 407.5 + x * 38, 309 + 6 * 38 + 5, 'circle', 'small'));
                makeMark('S0', 407.5 - 33, 309 + 6 * 38, 'circle', 'small');
                // Gray (tuvw)
                [0, 1, 2, 3].forEach(y =>
                    gen("tuvw"[y], 16).forEach(([id, x]) => {
                        const xMark = { 'v4': 'b', 't6': 'c', 'wc': 'd', 've': 'e', 'ug': 'f' }[id];
                        makeMark(id, 44 + x * 29.7, 607 + y * 30, 'small', xMark ? 'hide' : 'cross');
                        xMark && makeXMark(xMark, 44 + x * 29.7, 607 + y * 30, 'small');
                    }));
                gen("F3", 3).forEach(([id, y]) => makeMark(id, 545, 610 + y * 40, 'circle'))
                // Green (56G)
                gen('5', 11).forEach(([id, x]) => makeMark(id, 88 + x * 54.5, 778, 'small'));
                gen('6', 11).forEach(([id, x]) => makeMark(id, 88 - 20 + x * 54.5, 778 + 20, 'small'));
                gen('G', 11).forEach(([id, x]) => makeMark(id, 82 + x * 54, 744));
                makeXMark('g', 88 - 10 + 1 * 54.5, 778 + 40, 'small');
                makeXMark('h', 88 - 10 + 3 * 54.5, 778 + 40, 'small');
                makeXMark('i', 88 - 10 + 4 * 54.5, 778 + 40, 'small');
                makeXMark('j', 88 - 10 + 6 * 54.5, 778 + 40, 'small');
                makeXMark('k', 88 - 10 + 7 * 54.5, 778 + 40, 'small');
                makeXMark('l', 88 - 10 + 8 * 54.5, 778 + 40, 'small');
                // Pink (7U)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 73 + x * 50.3, 882));
                gen('U', 12).forEach(([id, x]) => [0, 2, 3, 4, 6, 7, 9, 11].includes(x) && makeMark(id, 73 + x * 50.3, 908, 'small', 'redcross'));
                makeXMark('m', 73 + 2 * 50.3, 908, 'small');
                makeXMark('n', 73 + 6 * 50.3, 908, 'small');
                makeXMark('o', 73 + 9 * 50.3, 908, 'small');
                makeXMark('p', 73 + 11 * 50.3, 908, 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R' || t === 'X') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B' || t === 'C') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '4') return true;
                if (t === '1') return prevMarked(id) && (i == 1 || state.marked[prevId(id)] !== 6)
                if (t >= '2' && t <= '7') return prevMarked(id);
                if (t === 't') return prevMarked(id) || makeId('t', i + 1) in state.marked || makeId('u', i) in state.marked;
                if (t === 'u') return prevMarked(id) || makeId('u', i + 1) in state.marked || makeId('t', i) in state.marked || makeId('v', i) in state.marked;
                if (t === 'v') return prevMarked(id) || makeId('v', i + 1) in state.marked || makeId('u', i) in state.marked || makeId('w', i) in state.marked;
                if (t === 'w') return prevMarked(id) || makeId('w', i + 1) in state.marked || makeId('v', i) in state.marked;
                return false;
            },
            markAsValue: (id) => ["1", "2", "3", "5", "6", "7", "G", "y"].includes(id[0]),
            allowValue: (id) => {
                if (id[0] !== '1' || id === '11') return allow1d();
                return allow1d(val => state.marked[prevId(id)] < val);
            },
            writeValue: (id, val) => val,
            score: () => {
                const yellowScore = -sumType('2') + sumType('3') + (state.marked['y3'] || 0);
                const blueScore = sumType('S', (v, i) => i + 6);
                const greyScore = [1, 2, 3, 4, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11].reduce((a, v, i) => a + (
                    [..."tuvw"].every(t => makeId(t, i + 1) in state.marked) ? v : 0
                ), 0);
                const greenScore = countType('G');
                const pinkScore = [0, 2, 4, 6, 9, 12, 15, 19, 23, 27, 32, 37, 42][countType('7')] + sumType('7', v => [0, 2, 0, 4, 0, 3][v - 1]);
                return addFoxScore(yellowScore, blueScore, greyScore, greenScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                [..."12345"].forEach(i => tryMark('s' + i, '1' + i, '2' + i, '3' + i));
                if (countType('2')) state.marked['y1'] = sumType('2');
                if (countType('3')) state.marked['y2'] = sumType('3');
                if (countType('s')) state.marked['y3'] = sumType('s', (v, i) => v ? [10, 10, 15, 15, 20][i - 1] : 0);
                tryMark('Q2', '12');
                tryMark('x2', '13');
                tryMark('x3', '14');
                tryMark('F1', '15');
                tryMark('O2', '21');
                tryMark('x4', '22');
                tryMark('x5', '23');
                tryMark('P2', '24');
                tryMark('x6', '25');
                // Blue
                const rows = [0, 1, 2, 3, 4, 5].map(i => [0, 1, 2, 3, 4, 5].filter(j => makeId('4', i * 6 + j) in state.marked).length);
                const cols = [0, 1, 2, 3, 4, 5].map(i => [0, 1, 2, 3, 4, 5].filter(j => makeId('4', j * 6 + i) in state.marked).length);
                const diags = [0, 1].map(d => [0, 1, 2, 3, 4, 5].filter(i => makeId('4', i * 6 + (d ? 5 - i : i)) in state.marked).length);
                cols.forEach((v, i) => v > 1 && (state.marked[makeId('S', i + 1)] = true));
                diags[1] > 1 && (state.marked['S0'] = true);
                rows[0] > 1 && (state.marked['x7'] = true);
                rows[1] > 1 && (state.marked['x8'] = true);
                rows[2] > 1 && (state.marked['x9'] = true);
                rows[3] > 1 && (state.marked['P3'] = true);
                rows[4] > 1 && (state.marked['xa'] = true);
                rows[5] > 1 && (state.marked['F2'] = true);
                diags[0] > 1 && (state.marked['O3'] = true);
                // Grey
                // t1 - D
                tryMarkAll('u1', 'v1', 'w1', 'v2'); // M
                tryMarkAll('t2', 'u2', 't3', 'u3', 'v3'); // L
                tryMarkAll('w2', 'w3'); // D
                tryMarkAll('t4', 't5', 't6', 't7', 'u7'); // M
                tryMarkAll('u4', 'u5', 'u6', 'v6', 'w6', 'w5'); // D
                tryMarkAll('v4', 'w4', 'v5'); // M
                tryMarkAll('v7', 'w7'); // L
                tryMarkAll('t8', 't9', 'u8', 'u9', 'ua'); // L
                tryMarkAll('v8', 'v9', 'w8', 'w9'); // D
                tryMarkAll('ta', 'tb', 'ub', 'vb', 'va', 'wa'); // M
                tryMarkAll('wb', 'wc', 'vc'); // L
                tryMarkAll('tc', 'uc'); // D
                tryMarkAll('td', 'ud', 'vd', 'wd', 'te'); // M
                tryMarkAll('ue', 've', 'we', 'vf'); // L
                // wf - M
                tryMarkAll('tf', 'uf', 'tg', 'ug', 'vg', 'wg'); // D
                const xMark = { 'v4': 'b', 't6': 'c', 'wc': 'd', 've': 'e', 'ug': 'f' };
                Object.entries(xMark).forEach(([k, v]) => tryMark('x' + v, k));
                tryMark('F3', 't2', 'v7', 't8', 'wb', 'ue');
                tryMark('F4', 'u1', 't4', 'v4', 'ta', 'td', 'wf')
                tryMark('F5', 't1', 'w2', 'u4', 'v8', 'tc', 'tf');
                tryMark('Q3', 't1');
                tryMark('O4', 'w1');
                tryMark('Q4', 'v6');
                tryMark('O5', 'u8');
                tryMark('P4', 'w8');
                tryMark('Q5', 'va');
                tryMark('Q6', 'td');
                tryMark('Q7', 'wf');
                // Green
                [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].forEach(i => {
                    const r = makeId('G', i), a = makeId('5', i), b = makeId('6', i);
                    if (a in state.marked && b in state.marked) state.marked[r] = (state.marked[a] + state.marked[b]) * (i > 3 ? 2 : 1);
                });
                gen('6', 12).forEach(([id, x]) => tryMark(['O6', 'xg', 'Q8', 'xh', 'xi', 'P5', 'xj', 'xk', 'xl', 'F6', 'P6'][x], id));
                // Pink
                for (let count3 = 0, i = 1; i <= 12; i++) if (makeId('7', i) in state.marked) {
                    if (state.marked[makeId('7', i)] === 3) count3++; else count3 = 0;
                } else {
                    if (count3 & 1) state.marked[makeId('7', i)] = 3;
                    break;
                }
                tryMarkMin('Q9', '71', 5, 'U1');
                tryMarkMin('xm', '73', 5, 'U3');
                tryMarkMin('P7', '74', 5, 'U4');
                tryMarkMin('O7', '75', 5, 'U5');
                tryMarkMin('xn', '77', 5, 'U7');
                tryMarkMin('F7', '78', 5, 'U8');
                tryMarkMin('xo', '7A', 5, 'UA');
                tryMarkMin('xp', '7C', 5, 'UC');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('x1', 'a7');
            }
        };

        const board4B = {
            id: '4B',
            name: 'Clever 4Ever: Challenge I',
            image: '4B.png',
            colorScheme: 'board4',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 146.5 + x * 96, 25, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 146.5 + x * 96, 25, 'cross'));
                makeMark('X0', 146.5 + 3 * 96, 67.5, 'cross');
                // Action tracks (ABC)
                gen('a', 6).forEach(([id, x]) => makeMark(id, 187 + x * 44, 130 + (x & 1) * 25, 'circle'));
                gen('A', 6).forEach(([id, x]) => makeMark(id, 187 + x * 44, 130 + (x & 1) * 25, 'cross'));
                gen('b', 6).forEach(([id, x]) => makeMark(id, 187 + x * 44, 221 + (x & 1) * 25, 'circle'));
                gen('B', 6).forEach(([id, x]) => makeMark(id, 187 + x * 44, 221 + (x & 1) * 25, 'cross'));
                gen('c', 3, 3).forEach(([id, x, y]) => makeMark(id, 533 + x * 44, 135 + y * 46, 'circle'));
                gen('C', 3, 3).forEach(([id, x, y]) => makeMark(id, 533 + x * 44, 135 + y * 46, 'cross'));
                makeMark('X1', 425, 169, 'cross', 'small');
                // Yellow (123sy)
                [1, 2, 3].forEach(y =>
                    gen(y.toString(), 5).forEach(([id, x]) => makeMark(id, 63 + x * 47 + (y > 1 ? 3 : 0), 347 + (y - 1) * 70))
                );
                gen('s', 5).forEach(([id, x]) => makeMark(id, 63 + x * 47, 347 + 190, 'small', 'circle'));
                makeMark('y1', 293, 452, 'small');
                makeMark('y3', 297, 536, 'small');
                makeMark('X2', 63 + 2 * 47, 373 + 0 * 70, 'small', 'cross');
                makeMark('X3', 63 + 3 * 47, 373 + 0 * 70, 'small', 'cross');
                makeMark('X4', 63 + 4 * 47, 373 + 0 * 70, 'small', 'cross');
                makeMark('X5', 63 + 2 * 47, 373 + 1 * 70, 'small', 'cross');
                makeMark('X6', 63 + 3 * 47, 373 + 2 * 70, 'small', 'cross');
                // Blue (4S)
                gen('40', 6, 6).forEach(([id, x, y]) => makeMark(id, 404 + x * 38, 313 + y * 38, 'cross', 'small'));
                makeMark('S1', 404 + 6 * 38 + 5, 313 + 0 * 38, 'small', 'circle')
                makeXMark('7', 404 + 6 * 38 + 5, 313 + 1 * 38, 'small')
                makeMark('S3', 404 + 6 * 38 + 5, 313 + 2 * 38, 'small', 'circle')
                makeXMark('8', 404 + 6 * 38 + 5, 313 + 3 * 38, 'small')
                makeMark('S5', 404 + 6 * 38 + 5, 313 + 4 * 38, 'small', 'circle')
                makeXMark('9', 404 + 6 * 38 + 5, 313 + 5 * 38, 'small')
                makeXMark('a', 404 + 6 * 38 - 2, 313 + 6 * 38 - 2, 'small')
                makeMark('O3', 404 + 0 * 38, 313 + 6 * 38 + 5, 'circle', 'small');
                makeMark('S2', 404 + 1 * 38, 313 + 6 * 38 + 5, 'circle', 'small');
                makeMark('P3', 404 + 2 * 38, 313 + 6 * 38 + 5, 'circle', 'small');
                makeMark('S4', 404 + 3 * 38, 313 + 6 * 38 + 5, 'circle', 'small');
                makeMark('F2', 404 + 4 * 38, 313 + 6 * 38 + 5, 'circle', 'small');
                makeMark('S6', 404 + 5 * 38, 313 + 6 * 38 + 5, 'circle', 'small');
                makeMark('S0', 404 - 34, 313 + 6 * 38 - 3, 'circle', 'small');
                // Gray (tuvw)
                [0, 1, 2, 3].forEach(y =>
                    gen("tuvw"[y], 19).forEach(([id, x]) => {
                        const xMark = { 'u4': 'b', 'v9': 'c', 've': 'd', 've': 'e', 'ug': 'f', 'wj': 'g' }[id];
                        const skip = ['t1', 'w3', 'w4', 'v4', 'u7', 'u8', 'va', 'wa', 'wb', 'uf', 'vf'].includes(id);
                        skip || makeMark(id, 40 + x * 29.7, 605 + y * 30, 'small', xMark ? 'hide' : 'cross');
                        xMark && makeXMark(xMark, 40 + x * 29.7, 605 + y * 30, 'small');
                    }));
                gen("F3", 3).forEach(([id, y]) => makeMark(id, 622.5, 610 + y * 41, 'circle'))
                // Green (56G)
                gen('5', 11).forEach(([id, x]) => makeMark(id, 88 + x * 54.2, 778, 'small'));
                gen('6', 7).forEach(([id, x]) => makeMark(id, 88 - 20 + [0, 2, 4, 6, 8, 9, 10][x] * 54.2, 778 + 20, 'small'));
                gen('G', 11).forEach(([id, x]) => makeMark(id, 79 + x * 54, 744));
                makeXMark('h', 88 - 13 + 2 * 54.2, 778 + 40, 'small');
                makeXMark('i', 88 - 13 + 4 * 54.2, 778 + 40, 'small');
                makeXMark('j', 88 - 13 + 8 * 54.2, 778 + 40, 'small');
                makeXMark('k', 88 - 13 + 10 * 54.2, 778 + 40, 'small');
                // Pink (7U)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 69 + x * 50.2, 880));
                gen('U', 12).forEach(([id, x]) => [1, 2, 3, 5, 6, 7, 9, 10, 11].includes(x) && makeMark(id, 69 + x * 50.2, 905, 'small', 'redcross'));
                makeXMark('l', 69 + 2 * 50.2, 905, 'small');
                makeXMark('m', 69 + 3 * 50.2, 905, 'small');
                makeXMark('n', 69 + 10 * 50.2, 905, 'small');
                makeXMark('o', 69 + 11 * 50.2, 905, 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R' || t === 'X') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B' || t === 'C') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '4') return true;
                if (t === '1') return prevMarked(id) && (i == 1 || state.marked[prevId(id)] !== 1);
                if (t >= '2' && t <= '7') return prevMarked(id);
                if (t === 't') return prevMarked(id) || makeId('t', i + 1) in state.marked || makeId('u', i) in state.marked;
                if (t === 'u') return prevMarked(id) || makeId('u', i + 1) in state.marked || makeId('t', i) in state.marked || makeId('v', i) in state.marked;
                if (t === 'v') return prevMarked(id) || makeId('v', i + 1) in state.marked || makeId('u', i) in state.marked || makeId('w', i) in state.marked;
                if (t === 'w') return prevMarked(id) || makeId('w', i + 1) in state.marked || makeId('v', i) in state.marked;
                return false;
            },
            markAsValue: (id) => ["1", "2", "3", "5", "6", "7", "G", "y"].includes(id[0]),
            allowValue: (id, val) => {
                if (id[0] !== '1' || id === '11') return allow1d();
                return allow1d(val => state.marked[prevId] > val);
            },
            writeValue: (id, val) => val,
            score: () => {
                const yellowScore = (state.marked['y1'] || 0) + (state.marked['y3'] || 0);
                const blueScore = sumType('S', (v, i) => i + 6) + sumType('z') * 5;
                const skipped = ['t1', 'w3', 'w4', 'v4', 'u7', 'u8', 'va', 'wa', 'wb', 'uf', 'vf'];
                const greyScore = [1, 2, 2, 2, 4, 5, 4, 5, 6, 5, 6, 7, 8, 8, 6, 9, 9, 10, 11].reduce((a, v, i) => a + (
                    [..."tuvw"].every(t => makeId(t, i + 1) in state.marked || skipped.includes(makeId(t, i + 1))) ? v : 0
                ), 0);
                const greenScore = countType('G');
                const pinkScore = [0, 2, 4, 6, 9, 12, 15, 19, 23, 27, 32, 37, 42][countType('7')] + sumType('7', v => [-5, 2, 0, 4, 0, 3][v - 1]);
                return addFoxScore(yellowScore, blueScore, greyScore, greenScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                [..."12345"].forEach(i => tryMark('s' + i, '1' + i, '2' + i, '3' + i));
                if (countType('2') || countType('3')) state.marked['y1'] = sumType('3', (v, i) => i & 1 ? v : -v) + sumType('2', (v, i) => i & 1 ? -v : v);
                if (countType('s')) state.marked['y3'] = sumType('s', (v, i) => v ? [10, 10, 15, 15, 20][i - 1] : 0);
                tryMark('O2', '12');
                tryMark('x2', '13');
                tryMark('x3', '14');
                tryMark('x4', '15');
                tryMark('Q2', '21');
                tryMark('x5', '23');
                tryMark('F1', '25');
                tryMark('P2', '32');
                tryMark('x6', '34');
                // Blue
                const rows = [0, 1, 2, 3, 4, 5].map(i => [0, 1, 2, 3, 4, 5].filter(j => makeId('4', i * 6 + j) in state.marked).length);
                const cols = [0, 1, 2, 3, 4, 5].map(i => [0, 1, 2, 3, 4, 5].filter(j => makeId('4', j * 6 + i) in state.marked).length);
                const diags = [0, 1].map(d => [0, 1, 2, 3, 4, 5].filter(i => makeId('4', i * 6 + (d ? 5 - i : i)) in state.marked).length);
                diags[1] > 1 && (state.marked['S0'] = true);
                rows[0] > 1 && (state.marked['S1'] = true);
                rows[1] > 1 && (state.marked['x7'] = true);
                rows[2] > 1 && (state.marked['S3'] = true);
                rows[3] > 1 && (state.marked['x8'] = true);
                rows[4] > 1 && (state.marked['S5'] = true);
                rows[5] > 1 && (state.marked['x9'] = true);
                diags[0] > 1 && (state.marked['xa'] = true);
                cols[0] > 1 && (state.marked['O3'] = true);
                cols[1] > 1 && (state.marked['S2'] = true);
                cols[2] > 1 && (state.marked['P3'] = true);
                cols[3] > 1 && (state.marked['S4'] = true);
                cols[4] > 1 && (state.marked['F2'] = true);
                cols[5] > 1 && (state.marked['S6'] = true);
                [...rows, ...cols, ...diags].forEach((v, i) => v > 2 && (state.marked[makeId('z', i)] = true));
                // Grey
                tryMarkAll('v1', 'u1', 'u2', 't2'); // L
                // w1 - D
                tryMarkAll('w2', 'v2', 'v3'); // M
                tryMarkAll('t3', 't4'); // M
                tryMarkAll('u3', 'u4', 'u5', 'v5', 'w5'); // D
                tryMarkAll('t5', 't6', 'u6'); // L
                tryMarkAll('v6', 'w6', 'v7', 'w7', 'v8'); // M
                tryMarkAll('t7', 't8', 't9', 'ta', 'tb', 'tc'); // D
                tryMarkAll('w8', 'w9');
                tryMarkAll('v9', 'u9', 'ua', 'ub'); // L
                tryMarkAll('vb', 'uc', 'vc', 'wc'); // M
                tryMarkAll('td', 'te', 'tf', 'ud', 'ue'); // L
                tryMarkAll('vd', 've', 'we'); // D
                // wd - L
                tryMarkAll('wf', 'wg', 'vg', 'ug', 'wh', 'wi'); // L
                tryMarkAll('tg', 'th', 'ti', 'tj', 'uh', 'vh'); // M
                tryMarkAll('vi', 'ui', 'uj'); // D
                tryMarkAll('vj', 'wj'); // M
                const xMark = { 'u4': 'b', 'v9': 'c', 've': 'd', 've': 'e', 'ug': 'f', 'wj': 'g' };
                Object.entries(xMark).forEach(([k, v]) => tryMark('x' + v, k));
                tryMark('F3', 'v1', 't5', 'v9', 'td', 'wd', 'wf');
                tryMark('F4', 'w2', 't3', 'v6', 'vb', 'tg', 'vj');
                tryMark('F5', 'w1', 'u3', 't7', 'w8', 'vd', 'vi');
                tryMark('O4', 'u1');
                tryMark('Q3', 'w1');
                tryMark('Q4', 'u6');
                tryMark('P4', 'w7');
                tryMark('Q5', 'ta');
                tryMark('Q6', 'wd');
                tryMark('O5', 'ti');
                // Green
                [1, 3, 5, 7, 9, 10, 11].forEach((i, j) => {
                    const r = makeId('G', i), a = makeId('5', i), b = makeId('6', j + 1);
                    if (a in state.marked && b in state.marked) state.marked[r] = (state.marked[a] + state.marked[b]) * (i > 9 ? 3 : 1);
                });
                [2, 4, 6, 8].forEach(i => {
                    const a = makeId('5', i);
                    if (a in state.marked) state.marked[makeId('G', i)] = state.marked[a] * 2 + i;
                });
                gen('6', 7).forEach(([id, x]) => tryMark(['Q7', 'xh', 'xi', 'P5', 'xj', 'F6', 'xk'][x], id));
                // Pink
                for (let count3 = 0, i = 1; i <= 12; i++) if (makeId('7', i) in state.marked) {
                    if (state.marked[makeId('7', i)] === 3) count3++; else count3 = 0;
                } else {
                    if (count3 & 1) state.marked[makeId('7', i)] = 3;
                    break;
                }
                tryMarkMin('O6', '72', 5, 'U2');
                tryMarkMin('xl', '73', 5, 'U3');
                tryMarkMin('xm', '74', 5, 'U4');
                tryMarkMin('Q8', '76', 5, 'U6');
                tryMarkMin('P6', '77', 5, 'U7');
                tryMarkMin('F7', '78', 5, 'U8');
                tryMarkMin('Q9', '7A', 5, 'UA');
                tryMarkMin('xn', '7B', 5, 'UB');
                tryMarkMin('xo', '7C', 5, 'UC');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('x1', 'a7');
            }
        };
        const boards = [board1A, board1B, board1B2, board2A, board2B, board3A, board3B, board4A, board4B, board1C];


        function allow1d(fn) { return fn ? [1, 2, 3, 4, 5, 6].filter(fn) : [1, 2, 3, 4, 5, 6] }
        function allow2d(fn) { return fn ? [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].filter(fn) : [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12] }
        function setupDiceModal(element, id) {
            const modal = document.getElementById('dice-modal');
            modal.querySelectorAll('div').forEach(e => e.remove());
            modal.style.display = 'flex';
            const xpos = element.offsetLeft + element.clientWidth / 2;
            const allowed = board.allowValue(id);
            allowed.forEach(i => {
                const face = document.createElement('div');
                face.textContent = i;
                face.onclick = () => {
                    state.marked[id] = board.writeValue(id, i);
                    logAppend(id + i.toString(36));
                    updateBoard();
                    modal.style.display = 'none';
                }
                modal.append(face);
            });
            const margin = (allowed.length * 50 + 50) / 2;
            modal.style.left = Math.min(Math.max(xpos, margin), getWidth() - margin) + 'px';
            modal.style.top = (element.offsetTop) + 'px';
        }
        function updateBoard() {
            board.autoMark();
            const scores = board.score(), totalScore = scores.reduce((a, v) => a + v, 0);
            scores.forEach((v, i) => document.getElementById('score' + (i + 1)).innerText = v);
            document.getElementById('score').innerText = totalScore;
            document.getElementById('menu-score-value').innerText = historyMode ? totalScore : '';
            document.querySelector('#menu-score svg').style.opacity = historyMode ? .4 : 1;
            const container = document.querySelector('#image-container');
            const markElements = container.querySelectorAll('.mark');
            markElements.forEach(function (element) {
                const id = element.id;
                if (board.markAsValue(id)) element.innerText = id in state.marked ? state.marked[id] : "";
                const canMark = !historyMode && board.canMark(id);
                element.style.zIndex = canMark ? 1 : 0;
                element.onclick = !canMark ? undefined : (ev) => {
                    const id = ev.target.id;
                    if (board.markAsValue(id)) {
                        setupDiceModal(element, id);
                    } else {
                        document.getElementById('dice-modal').style.display = 'none';
                        logAppend(id);
                        state.marked[id] = true;
                        updateBoard();
                    }
                }
                element.style.cursor = canMark ? 'pointer' : 'auto';
                if (id in state.marked) element.classList.add('marked'); else element.classList.remove('marked');
            });
            if (historyMode) {
                document.getElementById('history-modal-list').innerHTML = '';
                const usedBoards = historyBrowser.usedBoards();
                const historyEnties = historyBrowser.entries();
                historyEnties.forEach(({ date, score, board }, idx) => {
                    const entryDiv = document.createElement('div');
                    const dateDiv = document.createElement('div');
                    dateDiv.textContent = date;
                    const scoreDiv = document.createElement('div');
                    scoreDiv.textContent = score;
                    const boardDiv = document.createElement('div');
                    boardDiv.textContent = board.name;
                    entryDiv.append(dateDiv, boardDiv, scoreDiv);
                    entryDiv.onclick = () => {
                        historyBrowser.load(idx);
                        document.getElementById('history-modal').style.display = 'none';
                    }
                    document.getElementById('history-modal-list').append(entryDiv);
                })
                const boardFilter = document.getElementById('history-board-select').value;
                document.getElementById('history-board-select').innerHTML = '';
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "All Boards";
                document.getElementById('history-board-select').append(option);
                boards.forEach(b => {
                    if (!usedBoards.has(b.id)) return;
                    const option = document.createElement('option');
                    option.value = b.id;
                    option.textContent = b.name;
                    document.getElementById('history-board-select').append(option);
                })
                document.getElementById('history-board-select').value = boardFilter;
            }
            document.getElementById('menu-undo').classList[logCanUndo() ? 'remove' : 'add']('disabled');
            document.getElementById('menu-redo').classList[logCanRedo() ? 'remove' : 'add']('disabled');
            document.getElementById('log-slider').max = logMaxPos();
            document.getElementById('log-slider').value = logGetPos();
            document.getElementById('menu-history-prev').classList[historyBrowser.hasPrev() ? 'remove' : 'add']('disabled');
            document.getElementById('menu-history-next').classList[historyBrowser.hasNext() ? 'remove' : 'add']('disabled');
            document.getElementById('menu-bar').className = historyMode ? 'menu-mode-2' : 'menu-mode-0';
        }
        let historyFilterBoard = undefined;
        let historyFilterIncomplete = true;
        let historyOrder = 'date';
        let historyMode = false;
        let historySaved = false;
        const historyBrowser = (() => {
            const history = JSON.parse(localStorage.getItem('history') || '[]');
            let historyEntries;
            let currentIdx;
            let usedBoards;
            const toEntry = ({ l, b, s, t, i }, idx) => ({
                board: boards.find(board => board.id === b),
                date: new Date(t * 1000).toLocaleDateString(),
                incomplete: !!i,
                score: s,
                log: l,
                idx,
            });
            const load = (i = currentIdx) => {
                if (i < 0 || i >= historyEntries.length) return;
                currentIdx = i;
                const currentEntry = historyEntries[currentIdx];
                buildBoard(currentEntry.board);
                logFromString(currentEntry.log);
                return currentEntry;
            };
            const updateEntries = () => {
                usedBoards = new Set();
                historyEntries = history.map(toEntry);
                historyEntries.reverse();
                if (historyFilterIncomplete) historyEntries = historyEntries.filter(e => !e.incomplete);
                historyEntries.forEach(e => usedBoards.add(e.board.id));
                const boardFilter = document.getElementById('history-board-select').value;
                if (boardFilter) historyEntries = historyEntries.filter(e => e.board.id === boardFilter);
                if (historyOrder === 'score') historyEntries.sort((a, b) => b.score - a.score);
                currentIdx = 0;
            }
            updateEntries();
            return {
                updateEntries,
                entries: () => historyEntries,
                usedBoards: () => usedBoards,
                load,
                hasNext: () => currentIdx < historyEntries.length - 1,
                hasPrev: () => currentIdx > 0,
                remove: (i = currentIdx) => {
                    if (i < 0 || i >= historyEntries.length) return;
                    history.splice(historyEntries[i].idx, 1);
                    localStorage.setItem('history', JSON.stringify(history));
                    historyEntries.splice(i, 1);
                    if (i > currentIdx) currentIdx--;
                    if (i >= historyEntries.length) currentIdx = historyEntries.length - 1;
                    load();
                },
                next: () => load(currentIdx + 1),
                prev: () => load(currentIdx - 1),
                current: () => currentIdx < 0 ? {} : historyEntries[currentIdx],
                save: () => {
                    history.push({
                        b: board.id,
                        l: logToString(),
                        s: board.score().reduce((a, v) => a + v, 0),
                        t: Math.floor(Date.now() / 1000),
                        i: logIncomplete() ? 1 : undefined,
                    })
                    if (history.length > 1000) history.splice(0, history.length - 1000);
                    updateEntries();
                    localStorage.setItem('history', JSON.stringify(history));
                }
            }
        })();
        function maybeSaveHistory() {
            if (historySaved) return;
            historySaved = true;
            if (logEmpty()) return;
            historyBrowser.save();
            localStorage.removeItem('state');
        }
        boards.forEach(b => {
            const e = document.createElement('div');
            e.textContent = b.name;
            e.style.backgroundColor = {
                "board1": '#ffd503',
                "board2": '#939598',
                "board3": '#ff56ad',
                "board4": '#00aae2',
            }[b.colorScheme];
            e.onclick = () => {
                maybeSaveHistory();
                buildBoard(b);
                logClear();
                updateBoard();
                document.getElementById('board-modal').style.display = 'none';
            }
            document.getElementById('board-modal-list').append(e);
        })
        buildBoard(board1A);
        updateBoard();
        load();
        document.getElementById('board-back').onclick = () => document.getElementById('board-modal').style.display = 'none';
        document.getElementById('board-history').onclick = () => {
            maybeSaveHistory();
            document.getElementById('board-modal').style.display = 'none';
            document.getElementById('history-modal').style.display = 'flex';
            historyMode = true;
            updateBoard();
        }
        document.getElementById('scale-slider').value = parseFloat(localStorage.getItem('scale') || '100') || 100;
        if (logEmpty()) document.getElementById(historyMode ? 'history-modal' : 'board-modal').style.display = 'flex';
        window.addEventListener("resize", scaleContainer);
    </script>
</body>

</html>