<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable Clickable Image</title>
    <style>
        @font-face {
            font-family: "numbers";
            src: url(data:font/woff2;base64,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)format("woff2");
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            display: flex;
            height: 100vh;
            flex-direction: column;
            user-select: none;
            font-family: sans-serif;
            flex-direction: column;
        }

        #outer-container {
            position: relative;
            overflow: hidden;
            flex-grow: 1;
        }

        #image-container {
            width: 700px;
            height: 1000px;
            overflow: hidden;
            position: relative;
            left: 50%;
            top: 50%;
            transform-origin: center;
            transform: translate(-50%, -100%);
        }

        img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
        }

        .mark {
            position: absolute;
            border-radius: 50%;
            border: 5px solid transparent;
            font-family: 'numbers';
            font-size: 30px;
            line-height: 35px;
            width: 35px;
            height: 35px;
            text-align: center;
            /* background-color: rgba(0,0,0,.3); */
        }

        .circle.marked {
            border: 5px solid black;
        }

        .cross.marked {
            background-image: url('Ex.png');
            background-size: 100%;
            background-repeat: no-repeat;
        }

        .redcross.marked {
            background-image: url('Ex.png');
            background-size: 100%;
            background-repeat: no-repeat;
            filter: invert(14%) sepia(87%) saturate(6866%) hue-rotate(359deg) brightness(100%) contrast(114%);
        }

        .small {
            transform: scale(.75);
        }

        .hide {
            opacity: 0;
        }

        #resizable-image {
            position: absolute;
        }

        #dice-modal {
            position: absolute;
            display: none;
            font-family: 'numbers';
            color: #333;
            font-size: 38px;
            line-height: 38px;
            background-color: #777;
            border: 5px solid white;
            border-radius: 10px;
            transform: translate(-50%, -100%);
            z-index: 2;
        }

        .dice-value {
            display: block;
            width: 35px;
            height: 35px;
            border: 3px solid black;
            border-radius: 10px;
            text-align: center;
            background-color: white;
            margin: 5px;
            cursor: pointer;
        }

        #score-modal {
            position: absolute;
            width: 415px;
            gap: 10px 15px;
            flex-wrap: wrap;
            font-family: 'numbers';
            color: #333;
            font-size: 38px;
            line-height: 38px;
            background-color: #fff;
            border: 7px solid #ddd;
            border-radius: 13px;
            z-index: 2;
            padding: 10px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        #score-modal>div {
            box-sizing: border-box;
            width: 200px;
            height: 80px;
            border-radius: 13px;
            font-family: numbers;
            text-align: center;
            font-size: 55px;
            line-height: 80px;
        }

        #score-modal>div.score-points {
            border-width: 7px;
            border-style: solid;
            background-color: transparent;
            line-height: 66px;
        }

        #menu-bar {
            color: yellow;
            display: flex;
            gap: 30px;
            justify-content: center;
            height: 30px;
            font-size: 25px;
            line-height: 30px;
        }

        #menu-bar>input {
            width: 50%;
        }

        #menu-bar>.menu-mode-1 {
            display: none
        }

        #menu-bar.menu-mode-1>.menu-mode-1 {
            display: block
        }

        #menu-bar.menu-mode-1>.menu-mode-0 {
            display: none
        }

        .board1 div.color1 {
            background-color: #ffd503;
            border-color: #ffd503
        }

        .board1 div.color2 {
            background-color: #0b7cc1;
            border-color: #0b7cc1
        }

        .board1 div.color3 {
            background-color: #0baf4d;
            border-color: #0baf4d
        }

        .board1 div.color4 {
            background-color: #f58220;
            border-color: #f58220
        }

        .board1 div.color5 {
            background-color: #522f91;
            border-color: #522f91
        }

        .board2 div.color1 {
            background-color: #939598;
            border-color: #939598
        }

        .board2 div.color2 {
            background-color: #ffc20e;
            border-color: #ffc20e
        }

        .board2 div.color3 {
            background-color: #0c4da2;
            border-color: #0c4da2
        }

        .board2 div.color4 {
            background-color: #8dc63f;
            border-color: #8dc63f
        }

        .board2 div.color5 {
            background-color: #f287b7;
            border-color: #f287b7
        }

        .board3 div.color1 {
            background-color: #ffbd00;
            border-color: #ffbd00
        }

        .board3 div.color2 {
            background-color: #00a4a2;
            border-color: #00a4a2
        }

        .board3 div.color3 {
            background-color: #002498;
            border-color: #002498
        }

        .board3 div.color4 {
            background-color: #ba7b47;
            border-color: #ba7b47
        }

        .board3 div.color5 {
            background-color: #ff56ad;
            border-color: #ff56ad
        }

        .board4 div.color1 {
            background-color: #ffbd00;
            border-color: #ffbd00
        }

        .board4 div.color2 {
            background-color: #00aae2;
            border-color: #00aae2
        }

        .board4 div.color3 {
            background-color: #b0b2b4;
            border-color: #b0b2b4
        }

        .board4 div.color4 {
            background-color: #72ca36;
            border-color: #72ca36
        }

        .board4 div.color5 {
            background-color: #ff84c0;
            border-color: #ff84c0
        }
    </style>
</head>

<body>
    <div id="menu-bar">
        <div class="menu-mode-0" id="menu-score">SCORE</div>
        <div class="menu-mode-0" id="menu-undo">UNDO</div>
        <div class="menu-mode-0" id="menu-scale">ZOOM</div>
        <div class="menu-mode-0" id="menu-reset">RESET</div>
        <div class="menu-mode-1" id="menu-scale-close">BACK</div>
        <input class="menu-mode-1" type="range" id="scale-slider" value="100" min="30" max="100" step="1"
            oninput="scaleContainer()">
    </div>
    <div id="outer-container">
        <div id="image-container">
            <img id="resizable-image" src="back1.png" alt="Resizable Image">
            <div id="score-modal" style="display:none;">
                <div class="color1">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score1" class="color1 score-points">456</div>
                <div class="color2">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score2" class="color2 score-points">456</div>
                <div class="color3">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score3" class="color3 score-points">456</div>
                <div class="color4">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score4" class="color4 score-points">456</div>
                <div class="color5">
                    <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(-65.881249,-111.125)">
                            <path
                                d="m 0,0 -0.897,-0.641 -0.497,0.985 -1.093,-0.151 0.018,1.103 -1.037,0.374 0.528,0.969 -0.745,0.814 0.918,0.611 -0.282,1.067 1.098,0.115 0.246,1.075 L -0.718,5.913 0,6.751 0.718,5.913 1.743,6.321 1.99,5.246 3.087,5.131 2.806,4.064 3.723,3.453 2.979,2.639 3.507,1.67 2.469,1.296 2.487,0.193 1.395,0.344 0.897,-0.641 Z"
                                style="fill-opacity:0;fill-rule:evenodd;stroke:#ffffff;stroke-width:0.426;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                                transform="matrix(0.35277776,0,0,-0.35277776,70.395536,114.00836)" />
                        </g>
                    </svg>
                </div>
                <div id="score5" class="color5 score-points">456</div>
                <svg width="200" height="80" viewBox="0 0 9.0286407 3.6113858" xmlns="http://www.w3.org/2000/svg">
                    <g transform="translate(-1.8520818,-12.435417)">
                        <path
                            d="m 0,0 v 6.825 c 0,0.938 -0.768,1.706 -1.706,1.706 h -22.181 c -0.938,0 -1.706,-0.768 -1.706,-1.706 V 0 c 0,-0.938 0.768,-1.706 1.706,-1.706 H -1.706 C -0.768,-1.706 0,-0.938 0,0 m -0.853,0 c 0,-0.47 -0.382,-0.853 -0.853,-0.853 h -22.181 c -0.47,0 -0.853,0.383 -0.853,0.853 v 6.825 c 0,0.47 0.383,0.853 0.853,0.853 h 22.181 c 0.471,0 0.853,-0.383 0.853,-0.853 V 0"
                            style="fill:#ed1c24;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,10.880723,15.444964)" />
                        <path
                            d="M 0,0 C -0.013,0.017 -0.015,0.032 -0.009,0.053 0.078,0.333 0.15,0.617 0.219,0.902 0.28,1.154 0.339,1.407 0.387,1.662 0.411,1.786 0.436,1.91 0.459,2.035 0.487,2.188 0.512,2.341 0.536,2.496 0.557,2.628 0.575,2.761 0.587,2.895 0.596,2.991 0.607,3.087 0.614,3.183 0.622,3.318 0.657,3.695 0.528,3.78 0.398,3.864 -0.389,3.203 -0.594,3 -0.881,2.715 -1.153,2.417 -1.417,2.113 -1.57,1.937 -1.72,1.758 -1.869,1.579 -1.882,1.563 -1.893,1.56 -1.912,1.567 -2.042,1.616 -2.176,1.654 -2.313,1.677 -2.396,1.691 -2.477,1.706 -2.562,1.709 -2.62,1.711 -2.678,1.716 -2.736,1.715 -2.998,1.713 -3.253,1.662 -3.5,1.576 -3.543,1.561 -3.585,1.545 -3.627,1.527 -3.644,1.52 -3.653,1.523 -3.664,1.537 -3.852,1.769 -4.044,1.996 -4.241,2.22 -4.525,2.542 -5.666,3.849 -5.888,3.672 -6.11,3.494 -5.564,0.073 -5.508,-0.094 -5.513,-0.112 -5.526,-0.125 -5.536,-0.14 -5.912,-0.699 -6.19,-1.304 -6.389,-1.947 c -0.004,-0.01 -0.085,-0.128 -0.014,-0.161 0.071,-0.033 0.119,0.063 0.179,0.094 0.082,0.041 0.163,0.081 0.249,0.113 -0.005,-0.014 -0.18,-0.322 -0.084,-0.348 0.096,-0.026 0.384,0.135 0.568,0.186 0.247,0.07 0.497,0.109 0.753,0.065 0.244,-0.041 0.446,-0.154 0.6,-0.35 0.141,-0.179 0.218,-0.386 0.267,-0.605 0.033,-0.143 0.054,-0.29 0.107,-0.429 0.052,-0.138 0.125,-0.26 0.253,-0.341 0.061,-0.039 0.128,-0.058 0.196,-0.076 0.019,-0.039 0.048,-0.071 0.082,-0.098 0.124,-0.101 0.268,-0.148 0.425,-0.163 0.06,-0.006 0.12,-0.006 0.181,0 0.11,0.009 0.215,0.037 0.312,0.088 0.079,0.041 0.152,0.091 0.195,0.173 0.005,0.002 0.01,0.005 0.015,0.006 0.176,0.035 0.297,0.139 0.38,0.295 0.077,0.143 0.11,0.298 0.141,0.455 0.036,0.185 0.086,0.365 0.177,0.532 0.101,0.185 0.239,0.332 0.43,0.424 0.226,0.112 0.466,0.124 0.711,0.093 0.194,-0.025 0.381,-0.08 0.564,-0.15 C 0.4,-2.184 0.549,-2.307 0.621,-2.269 0.694,-2.23 0.604,-2.111 0.583,-2.033 0.57,-1.988 0.548,-1.947 0.541,-1.901 0.685,-1.961 0.935,-2.16 0.999,-2.128 1.063,-2.097 0.905,-1.801 0.848,-1.641 0.64,-1.056 0.362,-0.507 0,0"
                            style="fill:#ed1c24;fill-opacity:1;fill-rule:nonzero;stroke:#dfdfdf;stroke-width:0.341;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:3;stroke-dasharray:none;stroke-opacity:1"
                            transform="matrix(0.35277776,0,0,-0.35277776,7.1618804,14.150268)" />
                        <path
                            d="m 0,0 c 0.019,-0.189 -0.082,-0.321 -0.213,-0.436 -0.127,-0.111 -0.277,-0.165 -0.445,-0.151 -0.132,0.011 -0.245,0.073 -0.345,0.159 -0.105,0.092 -0.177,0.203 -0.209,0.34 -0.007,0.03 0,0.059 0.006,0.089 0.057,0.16 0.187,0.238 0.337,0.282 0.215,0.063 0.429,0.055 0.635,-0.039 C -0.125,0.194 -0.039,0.119 0,0"
                            style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,6.4231293,15.13152)" />
                        <path
                            d="M 0,0 C -0.282,0.003 -0.508,0.233 -0.506,0.516 -0.504,0.794 -0.273,1.021 0.008,1.02 0.292,1.018 0.518,0.789 0.514,0.505 0.51,0.201 0.262,-0.006 0,0"
                            style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,6.6620296,14.638125)" />
                        <path
                            d="M 0,0 C -0.257,0.001 -0.504,0.233 -0.492,0.528 -0.48,0.807 -0.248,1.027 0.033,1.019 0.302,1.01 0.531,0.8 0.528,0.493 0.526,0.215 0.285,-0.007 0,0"
                            style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
                            transform="matrix(0.35277776,0,0,-0.35277776,5.7486879,14.637913)" />
                    </g>
                </svg>
                <div id="score6" style="border: 7px solid #ed1c24; line-height: 66px;">123</div>
                <div style="font-family: sans-serif; font-weight:bold;">Σ</div>
                <div id="score" style="background-color: #d0d0d0;">1230</div>
            </div>
            <div id="dice-modal">
                <div id="D1" class="dice-value">1</div>
                <div id="D2" class="dice-value">2</div>
                <div id="D3" class="dice-value">3</div>
                <div id="D4" class="dice-value">4</div>
                <div id="D5" class="dice-value">5</div>
                <div id="D6" class="dice-value">6</div>
                <div id="D7" class="dice-value">7</div>
                <div id="D8" class="dice-value">8</div>
                <div id="D9" class="dice-value">9</div>
                <div id="D10" class="dice-value">10</div>
                <div id="D11" class="dice-value">11</div>
                <div id="D12" class="dice-value">12</div>
            </div>
        </div>
    </div>


    <script>
        function scaleContainer() {
            const sliderValue = document.getElementById('scale-slider').value;
            const container = document.getElementById('image-container');
            const baseScale = Math.min(container.parentElement.clientHeight / 1000, container.parentElement.clientWidth / 700);
            container.style.transform = `translate(-50%, -50%) scale(${sliderValue / 100 * baseScale})`;
        }
        document.getElementById('menu-score').onclick = document.getElementById('score-modal').onclick = () => {
            const e = document.getElementById('score-modal');
            e.style.display = e.style.display == 'none' ? 'flex' : 'none'
        };
        document.getElementById('menu-undo').onclick = () => {
            state.log.pop();
            replayLog();
        }
        document.getElementById('menu-reset').onclick = () => {
            state.log = [];
            replayLog();
        }
        document.getElementById('menu-scale').onclick = () => {
            const e = document.getElementById('menu-bar');
            e.classList.add("menu-mode-1");
        }
        document.getElementById('menu-scale-close').onclick = () => {
            const e = document.getElementById('menu-bar');
            e.classList.remove("menu-mode-1");
        }

        const state = {
            marked: {},
            log: [],
        }
        function replayLog() {
            state.marked = {};
            state.log.forEach(v => {
                state.marked[v.substring(0, 2)] = v.length > 2 ? board.writeValue(v.substring(0, 2), parseInt(v[2], 36)) : true;
                board.autoMark();
            });
            updateBoard();
        }
        function parseId(id) { return [id[0], parseInt(id[1], 36)]; }
        function makeId(t, i) {
            const isLower = t !== t.toUpperCase();
            const id = t + i.toString(36);
            return isLower ? id.toLowerCase() : id.toUpperCase();
        }
        function prevId(id) {
            const [t, i] = parseId(id);
            return i < 2 ? undefined : makeId(t, i - 1);
        }
        function prevMarked(id) {
            const prev = prevId(id);
            return !prev || prev in state.marked;
        }
        function tryMark(id, ...deps) {
            if (deps.every(d => d in state.marked)) state.marked[id] = true;
        }
        function tryMarkMin(id, dep, val, alt) {
            if (state.marked[dep] >= val) state.marked[id] = true;
            else if (alt !== undefined && (dep in state.marked)) state.marked[alt] = true;
        }
        function bonusMark(t1, t2) {
            const count = countType(t1);
            for (let i = 1; i <= count; i++) state.marked[t2 + i] = true;
        }
        function countType(t) {
            return Object.keys(state.marked).reduce((a, id) => a + (id[0] === t ? 1 : 0), 0);
        }
        function sumType(t) {
            return Object.keys(state.marked).reduce((a, id) => a + (id[0] === t ? state.marked[id] : 0), 0);
        }
        function addFoxScore(...scores) {
            return [...scores, countType('F') * Math.min(...scores)];
        }
        function makeMark(id, left, top, ...classes) {
            const container = document.querySelector('#image-container');
            const newDiv = document.createElement('div');
            newDiv.id = id;
            newDiv.classList.add('mark');
            classes.forEach(c => newDiv.classList.add(c));
            newDiv.style.top = top + 'px';
            newDiv.style.left = left + 'px';
            container.appendChild(newDiv);
        }
        function makeXMark(id, left, top, ...classes) {
            makeMark('x' + id, left, top, 'circle', ...classes);
            makeMark('X' + id, left, top, 'cross', ...classes);
        }
        function gen(t, w, h = 1, isValid = () => true) {
            const res = [];
            let idx = 1;
            if (t.length > 1) [t, idx] = parseId(t);
            const isLower = t !== t.toUpperCase();
            for (let j = 0; j < h; j++) for (let i = 0; i < w; i++) if (isValid(i, j)) {
                res.push([makeId(t, idx++), i, j]);
            }
            return res;
        }
        let board;
        function buildBoard(b) {
            board = b;
            const container = document.querySelector('#image-container');
            const image = document.querySelector('#resizable-image');
            const markElements = container.querySelectorAll('.mark');
            image.src = board.image;
            container.className = board.colorScheme;
            markElements.forEach(el => el.remove());
            board.buildBoard();
        }
        const board1A = {
            image: 'back1.png',
            colorScheme: 'board1',
            buildBoard: (container) => {
                // Round track
                gen('r', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'cross'));
                makeMark('X0', 141.5 + 3 * 96.6, 70, 'cross');
                // Action tracks
                gen('a', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'cross'));
                // Yellow
                gen('1', 4, 4, (x, y) => 3 - x !== y).forEach(([id, x, y]) => makeMark(id, 39 + x * 60, 359 + y * 57, 'cross'));
                makeXMark('1', 285, 359 + 0 * 57);
                makeXMark('2', 285, 359 + 1 * 57);
                makeXMark('3', 285, 359 + 2 * 57);
                makeMark('F1', 285, 359 + 3 * 57, 'circle');
                gen('S', 4).forEach(([id, x]) => makeMark(id, 39 + x * 60, 600, 'circle'));
                makeMark('P2', 285, 595, 'circle');
                // Blue
                gen('2', 4, 3, (x, y) => x + y).forEach(([id, x, y]) => makeMark(id, 378 + x * 60.7, 423.5 + y * 57, 'cross'));
                makeXMark('4', 626, 423.5 + 0 * 57);
                makeXMark('5', 626, 423.5 + 1 * 57);
                makeMark('F2', 626, 423.5 + 2 * 57, 'circle');
                makeMark('O3', 378 + 0 * 60.7, 603, 'circle');
                makeXMark('6', 378 + 1 * 60.7, 603);
                makeXMark('7', 378 + 2 * 60.7, 603);
                makeMark('P3', 378 + 3 * 60.7, 603, 'circle');
                // Green
                gen('3', 11).forEach(([id, x]) => makeMark(id, 91 + x * 52.9, 702.5, 'cross'));
                makeMark('X8', 91 + 5 * 52.9, 732, 'cross');
                makeMark('X9', 91 + 8 * 52.9, 732, 'cross');
                // Orange
                gen('4', 11).forEach(([id, x]) => makeMark(id, 91 + x * 52.9, 803));
                makeMark('XA', 91 + 4 * 52.9, 831, 'cross');
                makeMark('XB', 91 + 9 * 52.9, 831, 'cross');
                // Purple
                gen('5', 11).forEach(([id, x]) => makeMark(id, 91 + x * 52.9, 902.5));
                makeMark('XC', 91 + 3 * 52.9, 931.5, 'cross');
                makeMark('XD', 91 + 5 * 52.9, 931.5, 'cross');
                makeMark('XE', 91 + 8 * 52.9, 931.5, 'cross');
                makeMark('XF', 91 + 9 * 52.9, 931.5, 'cross');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = id;
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '3' || t === '4' || t === '5') return prevMarked(id);
                if (t === '1' || t === '2') return true;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '4' || id[0] === '5',
            allowValue: (id, val) => {
                if (val > 6) return false;
                if (id[0] !== '5') return true;
                const prev = prevId(id);
                if (!prev) return true;
                return state.marked[prev] === 6 || state.marked[prev] < val;
            },
            writeValue: (id, val) => (({ '44': 2, '47': 2, '49': 2, '4B': 3 })[id] || 1) * val,
            score: () => {
                let yellowScore = 0;
                if ('S1' in state.marked) yellowScore += 10;
                if ('S2' in state.marked) yellowScore += 14;
                if ('S3' in state.marked) yellowScore += 16;
                if ('S4' in state.marked) yellowScore += 20;
                const blueCount = countType('2');
                const blueScore = blueCount ? 1 + blueCount * (blueCount - 1) / 2 : 0;
                const greenCount = countType('3');
                const greenScore = greenCount * (greenCount + 1) / 2;
                const orangeScore = sumType('4');
                const purpleScore = sumType('5');
                return addFoxScore(yellowScore, blueScore, greenScore, orangeScore, purpleScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('O2', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('S1', '11', '14', '17');
                tryMark('S2', '12', '15', '1A');
                tryMark('S3', '13', '18', '1B');
                tryMark('S4', '16', '19', '1C');
                tryMark('P2', '11', '15', '18', '1C');
                tryMark('x1', '11', '12', '13');
                tryMark('x2', '14', '15', '16');
                tryMark('x3', '17', '18', '19');
                tryMark('F1', '1A', '1B', '1C');
                // Blue
                tryMark('x4', '21', '22', '23');
                tryMark('x5', '24', '25', '26', '27');
                tryMark('F2', '28', '29', '2A', '2B');
                tryMark('O3', '24', '28');
                tryMark('x6', '21', '25', '29');
                tryMark('x7', '22', '26', '2A');
                tryMark('P3', '23', '27', '2B');
                // Green
                tryMark('P4', '34');
                tryMark('x8', '36');
                tryMark('F3', '37');
                tryMark('x9', '39');
                tryMark('O4', '3A');
                // Orange
                tryMark('O5', '43');
                tryMark('xa', '45');
                tryMark('P5', '46');
                tryMark('F4', '48');
                tryMark('xb', '4A');
                // Purple
                tryMark('O6', '53');
                tryMark('xc', '54');
                tryMark('P6', '55');
                tryMark('xd', '56');
                tryMark('F5', '57');
                tryMark('O7', '58');
                tryMark('xe', '59');
                tryMark('xf', '5A');
                tryMark('P7', '5B');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
            }
        }
        const board1B = {
            image: '1B.png',
            colorScheme: 'board1',
            buildBoard: (container) => {
                // Round track
                gen('r', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 141.5 + x * 96.6, 27, 'cross'));
                makeMark('X0', 141.5 + 3 * 96.6, 70, 'cross');
                // Action tracks
                gen('a', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 150.85, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 215 + x * 66.3, 258.5, 'cross'));
                // Yellow
                gen('1', 4, 4, (x, y) => [1, 3, 0, 2][y] !== x).forEach(([id, x, y]) => makeMark(id, 65 + x * 54, 369 + y * 55.5, 'cross'));
                makeXMark('1', 290, 369 + 0 * 55.5);
                makeMark('S1', 290, 369 + 1 * 55.5, 'circle');
                makeXMark('2', 290, 369 + 2 * 55.5);
                makeMark('S2', 290, 369 + 3 * 55.5, 'circle');
                makeMark('S3', 65 + -45, 598, 'circle');
                makeMark('S4', 65 + 0 * 54, 598, 'circle');
                makeXMark('3', 65 + 1 * 54, 598);
                makeMark('P2', 65 + 2 * 54, 598, 'circle');
                makeMark('O3', 65 + 3 * 54, 598, 'circle');
                makeMark('F1', 285, 595, 'circle');
                // Blue
                gen('2', 4, 3).forEach(([id, x, y]) => makeMark(id, 378 + x * 60.7, 426 + y * 57.5, 'cross'));
                makeMark('F2', 627, 426 + 0 * 57.5, 'circle');
                makeXMark('4', 627, 426 + 1 * 57.5);
                makeXMark('5', 627, 426 + 2 * 57.5);
                makeXMark('6', 378 + 0 * 60.7, 607);
                makeXMark('7', 378 + 1 * 60.7, 607);
                makeXMark('8', 378 + 2 * 60.7, 607);
                makeMark('P3', 378 + 3 * 60.7, 607, 'circle');
                // Green
                gen('3', 11).forEach(([id, x]) => makeMark(id, 88 + x * 53.2, 709, 'cross'));
                makeMark('X9', 88 + 4 * 53.2, 739, 'cross');
                makeMark('XA', 88 + 7 * 53.2, 739, 'cross');
                // Orange
                gen('4', 11).forEach(([id, x]) => makeMark(id, 88 + x * 53.2, 811));
                makeMark('XB', 88 + 4 * 53.2, 840, 'cross');
                makeMark('XC', 88 + 9 * 53.2, 840, 'cross');
                // Purple
                gen('5', 11).forEach(([id, x]) => makeMark(id, 88 + x * 53.2, 910));
                makeMark('XD', 88 + 3 * 53.2, 940, 'cross');
                makeMark('XE', 88 + 4 * 53.2, 940, 'cross');
                makeMark('XF', 88 + 7 * 53.2, 940, 'cross');
                makeMark('XG', 88 + 9 * 53.2, 940, 'cross');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = id;
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '3' || t === '4' || t === '5') return prevMarked(id);
                if (t === '1' || t === '2') return true;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '4' || id[0] === '5',
            allowValue: (id, val) => {
                if (val > 6) return false;
                if (id[0] !== '5') return true;
                const prev = prevId(id);
                if (!prev) return true;
                return val === 6 || state.marked[prev] > val;
            },
            writeValue: (id, val) => (({ '41': -1, '43': 2, '44': 3, '45': -1, '47': 2, '48': 3, '49': -1, '4B': 4 })[id] || 1) * val,
            score: () => {
                let yellowScore = 0;
                if ('S1' in state.marked) yellowScore += 20;
                if ('S2' in state.marked) yellowScore += 16;
                if ('S3' in state.marked) yellowScore += 22;
                if ('S4' in state.marked) yellowScore += 12;
                const blueCount = countType('2');
                const blueScore = blueCount ? 1 + blueCount * (blueCount - 1) / 2 : 0;
                const greenCount = countType('3');
                const greenScore = greenCount * (greenCount + 1) / 2;
                const orangeScore = sumType('4');
                const purpleScore = sumType('5');
                return addFoxScore(yellowScore, blueScore, greenScore, orangeScore, purpleScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('O2', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('x1', '11', '12', '13');
                tryMark('S1', '14', '15', '16');
                tryMark('x2', '17', '18', '19');
                tryMark('S2', '1A', '1B', '1C');
                tryMark('S3', '13', '16', '17', '1A');
                tryMark('S4', '11', '14', '1A');
                tryMark('x3', '15', '17', '1B');
                tryMark('P2', '12', '16', '18');
                tryMark('O3', '13', '19', '1C');
                tryMark('F1', '11', '15', '18', '1C');
                // Blue
                tryMark('F2', '21', '22', '23', '24');
                tryMark('x4', '25', '26', '27', '28');
                tryMark('x5', '29', '2A', '2B', '2C');
                tryMark('x6', '21', '25', '29');
                tryMark('x7', '22', '26', '2A');
                tryMark('x8', '23', '27', '2B');
                tryMark('P3', '24', '28', '2C');
                // Green
                tryMark('O4', '33');
                tryMark('x9', '35');
                tryMark('P4', '36');
                tryMark('xa', '38');
                tryMark('F3', '39');
                // Orange
                tryMark('P5', '43');
                tryMark('xb', '45');
                tryMark('O5', '46');
                tryMark('F4', '47');
                tryMark('xc', '4A');
                // Purple
                tryMark('O6', '53');
                tryMark('xd', '54');
                tryMark('xe', '55');
                tryMark('F5', '56');
                tryMark('P6', '57');
                tryMark('xf', '58');
                tryMark('O7', '59');
                tryMark('xg', '5A');
                tryMark('P7', '5B');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                // TODO new printing action track bonuses
            }
        };
        const board2A = {
            image: '2A.png',
            colorScheme: 'board2',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 74, 'cross');
                // Action tracks (ABC)
                gen('a', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'circle'));
                gen('A', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'cross'));
                gen('c', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'circle'));
                gen('C', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'cross'));
                gen('b', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'circle'));
                gen('B', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 218, 'cross', 'small');
                makeMark('X2', 261 + 5 * 70.3 + 22, 218 + 67.5, 'cross', 'small');
                // Silver (1234)
                [1, 2, 3, 4].forEach(y =>
                    gen(y.toString(), 6).forEach(([id, x]) => makeMark(id, 37 + x * 50.8, 415 + (y - 1) * 49.5, 'cross'))
                );
                makeMark('P2', 37 + 0 * 50.8, 351, 'circle');
                makeXMark('3', 37 + 1 * 50.8, 351);
                makeMark('F1', 37 + 2 * 50.8, 351, 'circle');
                makeXMark('4', 37 + 3 * 50.8, 351);
                makeXMark('5', 37 + 4 * 50.8, 351);
                makeXMark('6', 37 + 5 * 50.8, 351);
                // Yellow (56)
                gen('5', 2, 3).forEach(([id, x, y]) => makeMark(id, 454 + x * 112, 415 + y * 64, 'circle'));
                gen('6', 2, 3).forEach(([id, x, y]) => makeMark(id, 454 + x * 112, 415 + y * 64, 'cross'));
                gen('57', 2, 2).forEach(([id, x, y]) => makeMark(id, 399 + x * 112, 448 + y * 64, 'circle'));
                gen('67', 2, 2).forEach(([id, x, y]) => makeMark(id, 399 + x * 112, 448 + y * 64, 'cross'));
                makeXMark('7', 627, 416 + 0 * 32, 'small');
                makeMark('Q2', 627, 416 + 1 * 32, 'small', 'circle');
                makeXMark('8', 627, 416 + 2 * 32, 'small');
                makeXMark('9', 627, 416 + 3 * 32, 'small');
                makeXMark('a', 627, 416 + 4 * 32, 'small');
                makeMark('O2', 399 + 0 * 56, 603, 'circle');
                makeMark('P3', 399 + 1 * 56, 603, 'circle');
                makeXMark('b', 399 + 2 * 56, 603);
                makeMark('F2', 399 + 3 * 56, 603, 'circle');
                // Blue (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 72 + x * 49.9, 703.5));
                makeMark('XC', 72 + 2 * 49.9, 731, 'cross', 'small');
                makeMark('XD', 72 + 6 * 49.9, 731, 'cross', 'small');
                makeMark('XE', 72 + 11 * 49.9, 731, 'cross', 'small');
                // Green (8)
                gen('8', 12).forEach(([id, x]) => makeMark(id, 72 + x * 49.9, 804));
                gen('T', 6).forEach(([id, x]) => makeMark(id, 72 + (2 * x + .5) * 49.9, 804 - 24, 'small'));
                makeMark('XF', 72 + 3 * 49.9, 832, 'cross', 'small');
                makeMark('XG', 72 + 7 * 49.9, 832, 'cross', 'small');
                makeMark('XH', 72 + 10 * 49.9, 832, 'cross', 'small');
                makeMark('XI', 72 + 11 * 49.9, 832, 'cross', 'small');
                // Pink (9)
                gen('9', 12).forEach(([id, x]) => makeMark(id, 72 + x * 49.9, 900.5));
                gen('U3', 10).forEach(([id, x]) => makeMark(id, 72 + (x + 2) * 49.9, 925.5, 'small', 'redcross'));
                makeMark('XJ', 72 + 5 * 49.9, 926, 'cross', 'small');
                makeMark('XK', 72 + 6 * 49.9, 926, 'cross', 'small');
                makeMark('XL', 72 + 8 * 49.9, 926, 'cross', 'small');
                makeMark('XM', 72 + 10 * 49.9, 926, 'cross', 'small');
                makeMark('XN', 72 + 11 * 49.9, 926, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = id;
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B' || t === 'C') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '7' || t === '8' || t === '9') return prevMarked(id);
                if (t >= '1' && t <= '5') return true;
                if (t === '6') return ('5' + i) in state.marked;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '7' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id, val) => {
                if (id[0] !== '7') return val < 7;
                if (val === 1) return false;
                const prev = prevId(id);
                return !prev || state.marked[prev] >= val;
            },
            writeValue: (id, val) => (({ '81': 2, '82': 2, '83': 2, '85': 3, '86': 3, '87': 3, '88': 2, '89': 3, '8B': 4 })[id] || 1) * val,
            score: () => {
                const silverScore = [..."1234"].reduce((a, i) => a + [0, 2, 4, 7, 11, 16, 22][countType(i)], 0);
                const yellowScore = [0, 3, 10, 21, 36, 55, 75, 96, 118, 141, 165][countType('6')];
                const blueCount = countType('7');
                const blueScore = blueCount * (blueCount + 1) / 2;
                const greenScore = sumType('T');
                const pinkScore = sumType('9');
                return addFoxScore(silverScore, yellowScore, blueScore, greenScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Silver
                tryMark('P2', '11', '21', '31', '41');
                tryMark('x3', '12', '22', '32', '42');
                tryMark('F1', '13', '23', '33', '43');
                tryMark('x4', '14', '24', '34', '44');
                tryMark('x5', '15', '25', '35', '45');
                tryMark('x6', '16', '26', '36', '46');
                // Yellow
                tryMark('x7', '51', '52');
                tryMark('Q2', '57', '58');
                tryMark('x8', '53', '54');
                tryMark('x9', '59', '5A');
                tryMark('xa', '56', '57');
                tryMark('O2', '57', '59');
                tryMark('P3', '51', '53', '55');
                tryMark('xb', '58', '5A');
                tryMark('F2', '52', '54', '56');
                // Blue
                tryMark('Q3', '72');
                tryMark('xc', '73');
                tryMark('P4', '75');
                tryMark('O3', '76');
                tryMark('xd', '77');
                tryMark('F3', '79');
                tryMark('Q4', '7A');
                tryMark('xe', '7C');
                // Green
                [1, 2, 3, 4, 5, 6].forEach(i => {
                    const r = makeId('T', i), a = makeId('8', 2 * i - 1), b = makeId('8', 2 * i);
                    if (a in state.marked && b in state.marked) state.marked[r] = state.marked[a] - state.marked[b];
                });
                tryMark('O4', '82');
                tryMark('xf', '84');
                tryMark('Q5', '85');
                tryMark('F4', '87');
                tryMark('xg', '88');
                tryMark('P5', '89');
                tryMark('xh', '8B');
                tryMark('xi', '8C');
                // Pink
                tryMarkMin('O5', '93', 2, 'U3');
                tryMarkMin('Q6', '94', 3, 'U4');
                tryMarkMin('P6', '95', 4, 'U5');
                tryMarkMin('xj', '96', 5, 'U6');
                tryMarkMin('xk', '97', 6, 'U7');
                tryMarkMin('F5', '98', 2, 'U8');
                tryMarkMin('xl', '99', 3, 'U9');
                tryMarkMin('O6', '9A', 4, 'UA');
                tryMarkMin('xm', '9B', 5, 'UB');
                tryMarkMin('xn', '9C', 6, 'UC');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('F0', 'a6');
                tryMark('x2', 'b6');
                tryMark('x1', 'c6');
            }
        };
        const board2B = {
            image: '2B.png',
            colorScheme: 'board2',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 32.5, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 74, 'cross');
                // Action tracks (ABC)
                gen('c', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'circle'));
                gen('C', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 139, 'cross'));
                gen('a', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'circle'));
                gen('A', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5, 'cross'));
                gen('b', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'circle'));
                gen('B', 6).forEach(([id, x]) => makeMark(id, 261 + x * 70.3, 206.5 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 218 - 67.5, 'cross', 'small');
                makeMark('X2', 261 + 5 * 70.3 + 22, 218 + 67.5, 'cross', 'small');
                // Silver (1234)
                [1, 2, 3, 4].forEach(y =>
                    gen(y.toString(), 7).forEach(([id, x]) => makeMark(id, 30 + x * 51.7, 413 + (y - 1) * 49.5, 'cross'))
                );
                makeMark('Q2', 30 + 0 * 51.7, 349, 'circle');
                makeMark('F1', 30 + 1 * 51.7, 349, 'circle');
                makeXMark('3', 30 + 2 * 51.7, 349);
                makeMark('P2', 30 + 3 * 51.7, 349, 'circle');
                makeXMark('4', 30 + 4 * 51.7, 349);
                makeXMark('5', 30 + 5 * 51.7, 349);
                makeXMark('6', 30 + 6 * 51.7, 349);
                // Yellow (56)
                gen('5', 3, 4).forEach(([id, x, y]) => makeMark(id, 445 + x * 56, 412 + y * 45, 'small', [2, 1, 2, 0][y] == x ? 'small' : 'circle'));
                gen('6', 3, 4).forEach(([id, x, y]) => makeMark(id, 445 + x * 56, 412 + y * 45, 'cross'));
                makeMark('O2', 620, 412 + 0 * 45, 'circle');
                makeXMark('7', 620, 412 + 1 * 45);
                makeXMark('8', 620, 412 + 2 * 45);
                makeXMark('9', 620, 412 + 3 * 45);
                makeMark('P3', 445 + 0 * 56, 603, 'circle');
                makeMark('F2', 445 + 1 * 56, 603, 'circle');
                makeXMark('a', 445 + 2 * 56, 603);
                // Blue (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 67 + x * 50.4, 703.5));
                makeMark('XB', 67 + 2 * 50.4, 733, 'cross', 'small');
                makeMark('XC', 67 + 4 * 50.4, 733, 'cross', 'small');
                makeMark('XD', 67 + 8 * 50.4, 733, 'cross', 'small');
                makeMark('XE', 67 + 11 * 50.4, 733, 'cross', 'small');
                // Green (8)
                gen('8', 12).forEach(([id, x]) => makeMark(id, 31 + x * 54 - (x & 1 ? 3 : 0), 806));
                gen('T', 6).forEach(([id, x]) => makeMark(id, 56 + x * 108, 804 - 22, 'small'));
                makeMark('XF', 31 + 2 * 54, 835, 'cross', 'small');
                makeMark('XG', 31 + 5 * 54 - 3, 835, 'cross', 'small');
                makeMark('XH', 31 + 9 * 54 - 3, 835, 'cross', 'small');
                makeMark('XI', 31 + 10 * 54, 835, 'cross', 'small');
                // Pink (9)
                gen('9', 12).forEach(([id, x]) => makeMark(id, 67 + x * 50.4, 904.5));
                gen('U', 12).forEach(([id, x]) => makeMark(id, 67 + x * 50.4, 929.5, 'small', 'redcross'));
                makeMark('XJ', 67 + 2 * 50.4, 929.5, 'cross', 'small');
                makeMark('XK', 67 + 4 * 50.4, 929.5, 'cross', 'small');
                makeMark('XL', 67 + 7 * 50.4, 929.5, 'cross', 'small');
                makeMark('XM', 67 + 10 * 50.4, 929.5, 'cross', 'small');
                makeMark('XN', 67 + 11 * 50.4, 929.5, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B' || t === 'C') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t === '7' || t === '9') return prevMarked(id);
                if (t === '8') {
                    const ii = ((i - 1) >> 1 << 1) - 1;
                    return i <= 2 || (makeId('8', ii) in state.marked && makeId('8', ii + 1) in state.marked);
                }
                if (t >= '1' && t <= '5') return true;
                if (t === '6') return makeId('5', i) in state.marked;
                if (t === 'X') return id.toLowerCase() in state.marked;
                return false;
            },
            markAsValue: (id) => id[0] === '7' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id, val) => {
                if (id[0] !== '7') return val < 7;
                if (val === 1) return false;
                const prev = prevId(id);
                return !prev || state.marked[prev] <= val;
            },
            writeValue: (id, val) => (({ '81': 2, '82': 2, '83': 2, '85': 3, '86': 3, '87': 3, '88': 2, '89': 3, '8B': 4 })[id] || 1) * val,
            score: () => {
                const silverScore = [..."1234"].reduce((a, i) => a + [0, 2, 5, 9, 14, 20, 27, 35][countType(i)], 0);
                const yellowScore = [0, 1, 6, 15, 28, 43, 59, 76, 94, 113, 133, 154, 176][countType('6')];
                const blueCount = countType('7');
                const blueScore = blueCount * (blueCount + 1) / 2;
                const greenScore = sumType('T');
                const pinkScore = sumType('9');
                return addFoxScore(silverScore, yellowScore, blueScore, greenScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Silver
                tryMark('Q2', '11', '21', '31', '41');
                tryMark('F1', '12', '22', '32', '42');
                tryMark('x3', '13', '23', '33', '43');
                tryMark('P2', '14', '24', '34', '44');
                tryMark('x4', '15', '25', '35', '45');
                tryMark('x5', '16', '26', '36', '46');
                tryMark('x6', '17', '27', '37', '47');
                // Yellow
                tryMark('53');
                tryMark('55');
                tryMark('59');
                tryMark('5A');

                tryMark('O2', '51', '52', '53');
                tryMark('x7', '54', '55', '56');
                tryMark('x8', '57', '58', '59');
                tryMark('x9', '5A', '5B', '5C');

                tryMark('P3', '51', '54', '57', '5A');
                tryMark('F2', '52', '55', '58', '5B');
                tryMark('xa', '53', '56', '59', '5C');
                // Blue
                tryMark('O3', '72');
                tryMark('xb', '73');
                tryMark('Q3', '74');
                tryMark('xc', '75');
                tryMark('P4', '77');
                tryMark('F3', '78');
                tryMark('xd', '79');
                tryMark('O4', '7B');
                tryMark('xe', '7C');
                // Green
                [1, 2, 3, 4, 5, 6].forEach(i => {
                    const r = makeId('T', i), a = makeId('8', 2 * i - 1), b = makeId('8', 2 * i);
                    if (a in state.marked && b in state.marked) state.marked[r] = state.marked[a] - state.marked[b];
                });
                tryMark('Q4', '82');
                tryMark('xf', '83');
                tryMark('P5', '84');
                tryMark('xg', '86');
                tryMark('O5', '87');
                tryMark('F4', '88');
                tryMark('xh', '8A');
                tryMark('xi', '8B');
                // Pink
                tryMarkMin('O6', '91', 2, 'U1');
                tryMarkMin('Q5', '92', 3, 'U2');
                tryMarkMin('xj', '93', 4, 'U3');
                tryMarkMin('xk', '95', 5, 'U5');
                tryMarkMin('P6', '96', 4, 'U6');
                tryMarkMin('F5', '97', 3, 'U7');
                tryMarkMin('xl', '98', 2, 'U8');
                tryMarkMin('Q6', '9A', 3, 'UA');
                tryMarkMin('xm', '9B', 4, 'UB');
                tryMarkMin('xn', '9C', 5, 'UC');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('F0', 'a6');
                tryMark('x2', 'b6');
                tryMark('x1', 'c6');
            }
        };
        const board3A = {
            image: '3A.png',
            colorScheme: 'board3',
            buildBoard: (container) => {
                // Round track (R)
                gen('r', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 30, 'circle'));
                gen('R', 6).forEach(([id, x]) => makeMark(id, 198.5 + x * 85, 30, 'cross'));
                makeMark('X0', 198.5 + 3 * 85, 71.5, 'cross');
                // Action tracks (ABC)
                gen('a', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 136.5, 'circle'));
                gen('A', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 136.5, 'cross'));
                gen('c', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204, 'circle'));
                gen('C', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204, 'cross'));
                gen('b', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204 + 67.5, 'circle'));
                gen('B', 7).forEach(([id, x]) => makeMark(id, 261 + x * 58.6, 204 + 67.5, 'cross'));
                makeMark('X1', 261 + 5 * 70.3 + 22, 215.5, 'cross', 'small');
                makeMark('X2', 261 + 5 * 70.3 + 22, 215.5 + 67.5, 'cross', 'small');
                // Yellow (123)
                [1, 2, 3].forEach(y =>
                    gen(y.toString(), 6).forEach(([id, x]) => makeMark(id, 64 + x * 47, 401.5 + (y - 1) * 91, 'cross'))
                );
                makeMark('O2', 64 + 0 * 47, 401.5 + 45.5, 'circle', 'small');
                makeMark('Q2', 64 + 1 * 47, 401.5 + 45.5, 'circle', 'small');
                makeXMark('3', 64 + 2 * 47, 401.5 + 45.5, 'small');
                makeMark('P2', 64 + 3 * 47, 401.5 + 45.5, 'circle', 'small');
                makeXMark('4', 64 + 4 * 47, 401.5 + 45.5, 'small');
                makeMark('F1', 64 + 5 * 47, 401.5 + 45.5, 'circle', 'small');
                makeMark('Q3', 64 + 0 * 47, 401.5 + 45.5 + 91, 'circle', 'small');
                makeXMark('5', 64 + 1 * 47, 401.5 + 45.5 + 91, 'small');
                makeXMark('6', 64 + 2 * 47, 401.5 + 45.5 + 91, 'small');
                makeXMark('7', 64 + 3 * 47, 401.5 + 45.5 + 91, 'small');
                makeXMark('8', 64 + 4 * 47, 401.5 + 45.5 + 91, 'small');
                makeMark('P3', 64 + 5 * 47, 401.5 + 45.5 + 91, 'circle', 'small');
                // Teal (4)
                gen('4', 6, 5).forEach(([id, x, y]) => makeMark(id, 381.5 + x * 41.1, 390 + y * 40.5, 'cross', 'small'));
                makeMark('F2', 635, 390 + 0 * 40.5, 'small', 'circle')
                makeMark('P4', 635, 390 + 1 * 40.5, 'small', 'circle')
                makeXMark('9', 635, 390 + 2 * 40.5, 'small')
                makeXMark('a', 635, 390 + 3 * 40.5, 'small')
                makeXMark('b', 381.5 + 0 * 41.1, 600, 'small');
                makeXMark('c', 381.5 + 1 * 41.1, 600, 'small');
                makeXMark('d', 381.5 + 2 * 41.1, 600, 'small');
                makeMark('Q4', 381.5 + 3 * 41.1, 600, 'small', 'circle');
                makeXMark('e', 381.5 + 4 * 41.1, 600, 'small');
                makeMark('O3', 381.5 + 5 * 41.1, 600, 'small', 'circle');
                // Blue (56)
                gen('5', 6).forEach(([id, x]) => makeMark(id, 33 + (5 - x) * 49, 676));
                gen('6', 6).forEach(([id, x]) => makeMark(id, 33 + (7 + x) * 49, 676));
                makeMark('XF', 33 + 3 * 49, 703, 'cross', 'small');
                makeMark('XG', 33 + 1 * 49, 703, 'cross', 'small');
                makeMark('XH', 33 + 9 * 49, 703, 'cross', 'small');
                makeMark('XI', 33 + 11 * 49, 703, 'cross', 'small');
                // Brown (7)
                gen('7', 12).forEach(([id, x]) => makeMark(id, 70 + x * 50.1, 817, 'cross'));
                makeMark('XJ', 95 + 1 * 50.1, 817, 'cross', 'small')
                makeMark('XK', 95 + 4 * 50.1, 817, 'cross', 'small')
                makeMark('XL', 95 + 7 * 50.1, 817, 'cross', 'small')
                makeMark('XM', 95 + 9 * 50.1, 817, 'cross', 'small')
                // Pink (89)
                gen('92', 11).forEach(([id, x]) => makeMark(id, 70 + (x + 1) * 50.1, 899 - 32, 'hide'));
                gen('8', 12).forEach(([id, x]) => makeMark(id, 70 + x * 50.1, 899));
                gen('U2', 11).forEach(([id, x]) => makeMark(id, 70 + (x + 1) * 50.1, 924, 'small', 'redcross'));
                gen('T2', 11).forEach(([id, x]) => makeMark(id, 70 + (x + 1) * 50.1, 899));
                makeMark('XN', 70 + 2 * 50.1, 924, 'cross', 'small');
                makeMark('XO', 70 + 5 * 50.1, 924, 'cross', 'small');
                makeMark('XP', 70 + 6 * 50.1, 924, 'cross', 'small');
                makeMark('XQ', 70 + 9 * 50.1, 924, 'cross', 'small');
                makeMark('XR', 70 + 10 * 50.1, 924, 'cross', 'small');
                makeMark('XS', 70 + 11 * 50.1, 924, 'cross', 'small');
            },
            canMark: (id) => {
                if (id in state.marked) return false;
                const [t, i] = parseId(id);
                if (t === 'R' || t === 'C' || t === 'X') return id.toLowerCase() in state.marked;
                if (t === 'r') return prevMarked(id);
                if (t === 'A' || t === 'B') return id.toLowerCase() in state.marked && prevMarked(id);
                if (t >= '1' && t <= '4') return true;
                if (t === '5' || t === '6') return prevMarked(id);
                if (t === '7') return [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].every(k => k <= i || !(makeId('7', k) in state.marked));
                if (t === '8' || t === '9')
                    return (i === 1 || makeId('8', i - 1) in state.marked || makeId('9', i - 1) in state.marked) &&
                        !(makeId(t === '8' ? '9' : '8', i) in state.marked);
                return false;
            },
            markAsValue: (id) => id[0] === '5' || id[0] === '6' || id[0] === '8' || id[0] === '9' || id[0] === 'T',
            allowValue: (id, val) => {
                if (id[0] !== '5' && id[0] !== '6') return val < 7;
                if (val === 1) return false;
                if (val === 7) return true;
                const prev = prevId(id);
                const prevVal = prev ? state.marked[prev] : 7;
                const reqVal = prevVal + (id[0] === '5' ? -1 : 1);
                return val === reqVal;
            },
            writeValue: (id, val) => id[0] === '8' ? [1, 1, 2, 2, 3, 3][val - 1] : (({ '93': 2, '94': 2, '96': 2, '97': 2, '99': 3, '9A': 2, '9B': 2, '9C': 3 })[id] || 1) * val,
            score: () => {
                const yellowScore = [..."123"].reduce((a, i) => a + [0, 2, 6, 12, 20, 30, 42][countType(i)], 0);
                const tealScore = [0, 1, 2, 3, 4].reduce((a, i) => a + (
                    [0, 1, 3, 6, 10, 15, 21][[0, 1, 2, 3, 4, 5].filter(j => makeId('4', i * 6 + j + 1) in state.marked).length]
                ), 0);
                const blueCount = countType('7');
                const blueScore = ["5", "6"].reduce((a, v) => a + [0, 3, 6, 9, 13, 17, 22][countType(v)] +
                    [..."123456"].reduce((a, i) => a + (state.marked[v + i] < 5 || state.marked[v + i] > 9 ? 4 : 0), 0),
                    0);
                const brownCount = countType('7');
                const brownScore = (brownCount + 1) * (brownCount + 2) / 2 - 1;
                const pinkScore = sumType('8') + sumType('9');
                return addFoxScore(yellowScore, tealScore, blueScore, brownScore, pinkScore);
            },
            autoMark: () => {
                // Round track
                tryMark('O1', 'r1');
                tryMark('P1', 'r2');
                tryMark('Q1', 'r3');
                tryMark('x0', 'r4');
                tryMark('R1', 'r2');
                tryMark('R2', 'r3');
                tryMark('R3', 'r4');
                tryMark('R4', 'r5');
                tryMark('R5', 'r6');
                // Yellow
                tryMark('O2', '11', '21');
                tryMark('Q2', '12', '22');
                tryMark('x3', '13', '23');
                tryMark('P2', '14', '24');
                tryMark('x4', '15', '25');
                tryMark('F1', '16', '26');
                tryMark('Q3', '21', '31');
                tryMark('x5', '22', '32');
                tryMark('x6', '23', '33');
                tryMark('x7', '24', '34');
                tryMark('x8', '25', '35');
                tryMark('P3', '26', '36');
                // Teal
                tryMark('F2', '41', '42', '43', '44', '45', '46');
                tryMark('P4', '47', '48', '49', '4A', '4B'); // C
                tryMark('x9', '4D', '4E', '4F'); // GHI
                tryMark('xa', '4J', '4K'); // LMNO
                tryMark('xb', '41', '47', '4D', '4J', '4P');
                tryMark('xc', '42', '48', '4E', '4K');
                tryMark('xd', '43', '49', '4F');
                tryMark('Q4', '44', '4A');
                tryMark('xe', '45', '4B');
                tryMark('O3', '46');
                // Blue
                tryMark('Q5', '52');
                tryMark('xf', '53');
                tryMark('xg', '55');
                tryMark('P5', '56');
                tryMark('O4', '62');
                tryMark('xh', '63');
                tryMark('xi', '65');
                tryMark('F3', '66');
                // Brown
                tryMark('Q6', '71', '72');
                tryMark('xj', '72', '73');
                tryMark('O5', '75', '75');
                tryMark('xk', '75', '76');
                tryMark('P6', '77', '78');
                tryMark('xl', '78', '79');
                tryMark('xm', '7A', '7B');
                tryMark('F4', '7B', '7C');
                // Pink
                for (let i = 2; i <= 12; i++) if (makeId('9', i) in state.marked) {
                    state.marked[makeId('U', i)] = true;
                    state.marked[makeId('T', i)] = state.marked[makeId('9', i)];
                }
                tryMark('O6', '82');
                tryMark('xn', '83');
                tryMark('P7', '84');
                tryMark('Q7', '85');
                tryMark('xo', '86');
                tryMark('xp', '87');
                tryMark('O7', '88');
                tryMark('F5', '89');
                tryMark('xq', '8A');
                tryMark('xr', '8B');
                tryMark('xs', '8C');
                // Bonus tracks
                bonusMark('O', 'a');
                bonusMark('P', 'b');
                bonusMark('Q', 'c');
                tryMark('F0', 'a6');
                tryMark('x2', 'b6');
                tryMark('x1', 'c6');
            }
        };



        function setupDiceModal(element, id) {
            const modal = document.getElementById('dice-modal');
            modal.style.display = 'flex';
            const xpos = element.offsetLeft + element.clientWidth / 2;
            let cnt = 0;
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].forEach(i => {
                const face = document.getElementById('D' + i);
                const allowed = board.allowValue(id, i);
                face.style.display = allowed ? 'block' : 'none';
                if (allowed) {
                    cnt++;
                    face.onclick = () => {
                        state.marked[id] = board.writeValue(id, i);
                        state.log.push(id + i.toString(36));
                        updateBoard();
                        modal.style.display = 'none';
                    }
                }
            });
            const margin = (cnt * 50 + 50) / 2;
            modal.style.left = Math.min(Math.max(xpos, margin), 700 - margin) + 'px';
            modal.style.top = (element.offsetTop) + 'px';
        }
        function updateBoard() {
            board.autoMark();
            const scores = board.score();
            scores.forEach((v, i) => document.getElementById('score' + (i + 1)).innerText = v);
            document.getElementById('score').innerText = scores.reduce((a, v) => a + v, 0);
            const container = document.querySelector('#image-container');
            const markElements = container.querySelectorAll('.mark');
            markElements.forEach(function (element) {
                const id = element.id;
                if (board.markAsValue(id)) element.innerText = id in state.marked ? state.marked[id] : "";
                const canMark = board.canMark(id);
                element.style.zIndex = canMark ? 1 : 0;
                element.onclick = !canMark ? undefined : (ev) => {
                    const id = ev.target.id;
                    if (board.markAsValue(id)) {
                        setupDiceModal(element, id);
                    } else {
                        document.getElementById('dice-modal').style.display = 'none';
                        state.log.push(id);
                        state.marked[id] = true;
                        updateBoard();
                    }
                }
                element.style.cursor = canMark ? 'pointer' : 'auto';
                if (id in state.marked) element.classList.add('marked'); else element.classList.remove('marked');
            });
        }
        buildBoard(board3A);
        scaleContainer();
        updateBoard();
        window.addEventListener("resize", scaleContainer);
    </script>
</body>

</html>